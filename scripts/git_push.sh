#!/bin/bash

# Christmas ?로?트 변??항 ?시 ?크립트
# ???크립트??변경된 ?일??GitHub???동?로 ?시?니??

# 커밋 메시지 ?인
if [ -z "$1" ]; then
    echo "커밋 메시지??력?세??"
    echo "?용? $0 '커밋 메시지'"
    exit 1
fi

COMMIT_MESSAGE="$1"

# 브랜??인
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
echo "?재 브랜? $CURRENT_BRANCH"

# ?태 ?인
git status

# ?인 ?청
read -p "??변??항??'$CURRENT_BRANCH' 브랜치에 커밋?시겠습?까? (y/n): " CONFIRM
if [ "$CONFIRM" != "y" ]; then
    echo "커밋??취소?었?니??"
    exit 0
fi

# 변??항 추?
echo "변??항??추??니??.."
git add .

# 변??항 커밋
echo "변??항??커밋?니??.."
git commit -m "$COMMIT_MESSAGE"

# 변??항 ?시
echo "$CURRENT_BRANCH 브랜치에 변??항???시?니??.."
git push origin $CURRENT_BRANCH

# 결과 ?인
if [ $? -eq 0 ]; then
    echo "?시가 ?공?으??료?었?니??"
else
    echo "?시 ??류가 발생?습?다. ???류 메시지??인?세??"
    exit 1
fi

# Docker ??지 ?리 (?택 ?항)
echo "?용?? ?는 Docker ??지??리?니??.."
docker image prune -f

echo "?료 - $(date)" 