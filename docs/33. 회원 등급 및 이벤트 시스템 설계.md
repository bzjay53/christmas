# Christmas í”„ë¡œì íŠ¸ - íšŒì› ë“±ê¸‰ ë° ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ì í™•ë³´ì™€ ìˆ˜ìµí™” ìµœì í™”ë¥¼ ìœ„í•œ íšŒì› ë“±ê¸‰ ì²´ê³„, ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ, ì¿ í° ì‹œìŠ¤í…œì„ ì„¤ê³„í•©ë‹ˆë‹¤.

## ğŸ‘¥ íšŒì› ë“±ê¸‰ ì²´ê³„ (ìˆ˜ì •)

### ğŸš« ë¹„íšŒì› (Guest)
```yaml
ì ‘ê·¼_ê¶Œí•œ:
  - ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
  - ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - íšŒì›ê°€ì… ì•ˆë‚´ í˜ì´ì§€

ì œí•œ_ì‚¬í•­:
  - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
  - ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€
  - ë°ëª¨ ëª¨ë“œë„ ì œê³µí•˜ì§€ ì•ŠìŒ
```

### ğŸ†“ ë¬´ë£Œ íšŒì› (Free Member)
```yaml
ê¸°ë³¸_í˜œíƒ:
  - ë§¤ì¼ ëª¨ì˜ íˆ¬ì ë§¤ë§¤ 2íšŒ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
  - ê¸°ë³¸ ì°¨íŠ¸ ì¡°íšŒ (ì œí•œì )
  - íˆ¬ì êµìœ¡ ì½˜í…ì¸  (ê¸°ì´ˆ ê³¼ì •ë§Œ)

ì‹ ê·œ_ê°€ì…_í˜œíƒ:
  - ìµœì´ˆ ê°€ì… í›„ 7ì¼ê°„ ë¬´ì œí•œ ëª¨ì˜ ë§¤ë§¤
  - 7ì¼ í›„ ì¼ì¼ 2íšŒ ì œí•œìœ¼ë¡œ ë³€ê²½
  - ìœ ë£Œ íšŒì› ì „í™˜ ì•ˆë‚´

ì œí•œ_ì‚¬í•­:
  - ì‹¤ì „ ê±°ë˜ ì™„ì „ ì°¨ë‹¨
  - API ì—°ë™ ë¶ˆê°€
  - ê³ ê¸‰ ë¶„ì„ ë„êµ¬ ì œí•œ
  - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì œí•œ
  - ë°±í…ŒìŠ¤íŒ… ë¶ˆê°€
```

### ğŸ’ í”„ë¦¬ë¯¸ì—„ íšŒì› (Premium Member)
```yaml
ì›”_êµ¬ë…_í˜œíƒ:
  - ìš”ê¸ˆ: $15/ì›”
  - ì‹¤ì „ ê±°ë˜ ë¬´ì œí•œ
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ: 1%
  - ëª¨ë“  ì°¨íŠ¸ ë° ì§€í‘œ ì´ìš©
  - ì‹¤ì‹œê°„ ì•Œë¦¼ (í…”ë ˆê·¸ë¨, ì´ë©”ì¼)
  - ë°±í…ŒìŠ¤íŒ… ê¸°ëŠ¥
  - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë¶„ì„
  - ìš°ì„  ê³ ê° ì§€ì›

ì¶”ê°€_ê¸°ëŠ¥:
  - API í‚¤ ê°œì¸ ì„¤ì •
  - ê³ ê¸‰ ë§¤ë§¤ ì „ëµ ì´ìš©
  - ì»¤ë®¤ë‹ˆí‹° ì „ì²´ ì ‘ê·¼
  - ì›”ê°„ íˆ¬ì ë¦¬í¬íŠ¸
```

### ğŸ† ë¼ì´í”„íƒ€ì„ íšŒì› (Lifetime Member)
```yaml
ì¼ì‹œë¶ˆ_í˜œíƒ:
  - ìš”ê¸ˆ: â‚©10,000,000 (í™˜ë¶ˆ ë¶ˆê°€)
  - ëª¨ë“  í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ ì™„ì „ ë©´ì œ
  - VIP ì „ìš© ê¸°ëŠ¥
  - ê°œì¸ ë§ì¶¤ ì „ëµ ì»¨ì„¤íŒ…
  - ë² íƒ€ ê¸°ëŠ¥ ìš°ì„  ì²´í—˜
  - ì „ìš© ê³ ê° ì§€ì› ì±„ë„
  - í‰ìƒ ì„œë¹„ìŠ¤ ë³´ì¥

íŠ¹ë³„_í˜œíƒ:
  - ì‹ ê·œ ê¸°ëŠ¥ ë¬´ë£Œ ì—…ê·¸ë ˆì´ë“œ
  - ì›”ê°„ ê°œì¸ íˆ¬ì ìƒë‹´
  - VIP ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼
  - ì—°ê°„ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜ ì°¸ì„ê¶Œ
```

## ğŸ ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ

### ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹œìŠ¤í…œ
```python
# models/ReferralCode.py
class ReferralCode:
    """ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ ëª¨ë¸"""
    
    def __init__(self):
        self.user_id = None          # ì´ˆëŒ€ì ID
        self.code = None             # 8ìë¦¬ ê³ ìœ  ì½”ë“œ
        self.invite_url = None       # ì´ˆëŒ€ ë§í¬ URL
        self.created_at = None       # ìƒì„± ì¼ì‹œ
        self.expires_at = None       # ë§Œë£Œ ì¼ì‹œ (90ì¼ í›„)
        self.max_uses = 50           # ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜
        self.current_uses = 0        # í˜„ì¬ ì‚¬ìš© íšŸìˆ˜
        self.is_active = True        # í™œì„± ìƒíƒœ
        
    def generate_code(self, user_id):
        """ê³ ìœ  ì´ˆëŒ€ ì½”ë“œ ìƒì„±"""
        import random
        import string
        from datetime import datetime, timedelta
        
        # 8ìë¦¬ ì˜ìˆ«ì ì¡°í•© ì½”ë“œ ìƒì„±
        self.code = ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=8
        ))
        
        self.user_id = user_id
        self.invite_url = f"https://christmas-trading.com/signup?ref={self.code}"
        self.created_at = datetime.now()
        self.expires_at = datetime.now() + timedelta(days=90)
        
        return self.code
    
    def is_valid(self):
        """ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬"""
        from datetime import datetime
        
        return (
            self.is_active and 
            self.current_uses < self.max_uses and
            datetime.now() < self.expires_at
        )

# models/ReferralReward.py
class ReferralReward:
    """ì´ˆëŒ€ ë³´ìƒ ëª¨ë¸"""
    
    def __init__(self):
        self.inviter_id = None       # ì´ˆëŒ€ì ID
        self.invitee_id = None       # í”¼ì´ˆëŒ€ì ID
        self.referral_code = None    # ì‚¬ìš©ëœ ì´ˆëŒ€ ì½”ë“œ
        self.reward_type = 'free_extension'  # ë³´ìƒ ìœ í˜•
        self.reward_days = 7         # ë³´ìƒ ì¼ìˆ˜
        self.created_at = None       # ë³´ìƒ ìƒì„± ì¼ì‹œ
        self.applied_at = None       # ë³´ìƒ ì ìš© ì¼ì‹œ
        self.is_claimed = False      # ë³´ìƒ ìˆ˜ë ¹ ì—¬ë¶€
        
    def apply_reward(self, inviter_id, invitee_id, code):
        """ì´ˆëŒ€ ë³´ìƒ ì ìš©"""
        from datetime import datetime
        
        self.inviter_id = inviter_id
        self.invitee_id = invitee_id
        self.referral_code = code
        self.created_at = datetime.now()
        
        # ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ë¶€ì—¬
        self.extend_membership(inviter_id, 7)
        self.is_claimed = True
        self.applied_at = datetime.now()
        
    def extend_membership(self, user_id, days):
        """íšŒì›ê¶Œ ì—°ì¥"""
        user = User.get_by_id(user_id)
        current_total_extension = self.get_total_extension_days(user_id)
        
        # ìµœëŒ€ 3ê°œì›”(90ì¼) ì œí•œ í™•ì¸
        if current_total_extension + days <= 90:
            user.extend_free_period(days)
            return True
        else:
            # 90ì¼ í•œë„ ì´ˆê³¼ì‹œ ë‚¨ì€ ì¼ìˆ˜ë§Œ ì—°ì¥
            remaining_days = 90 - current_total_extension
            if remaining_days > 0:
                user.extend_free_period(remaining_days)
            return False
```

### ì´ˆëŒ€ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°
```yaml
ì´ˆëŒ€_í”„ë¡œì„¸ìŠ¤:
  1. ì´ˆëŒ€ìê°€ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
  2. ì´ˆëŒ€ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ 
  3. ì¹œêµ¬ê°€ ë§í¬ë¥¼ í†µí•´ íšŒì›ê°€ì…
  4. ì‹œìŠ¤í…œì´ ì´ˆëŒ€ ê´€ê³„ í™•ì¸
  5. ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ìë™ ì§€ê¸‰
  6. í”¼ì´ˆëŒ€ìëŠ” ì‹ ê·œ ê°€ì… í˜œíƒ (7ì¼ ë¬´ë£Œ) ì œê³µ

ì œí•œ_ì‚¬í•­:
  - ì´ˆëŒ€ìë‹¹ ìµœëŒ€ ì—°ì¥ ê¸°ê°„: 3ê°œì›” (90ì¼)
  - ì½”ë“œ ìœ íš¨ ê¸°ê°„: 90ì¼
  - ì½”ë“œë‹¹ ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜: 50íšŒ
  - ìê°€ ì´ˆëŒ€ ë°©ì§€ ë¡œì§ êµ¬í˜„
```

## ğŸ« ì¿ í° ì‹œìŠ¤í…œ

### ì¿ í° ìœ í˜• ì„¤ê³„
```python
# models/Coupon.py
class Coupon:
    """ì¿ í° ì‹œìŠ¤í…œ ëª¨ë¸"""
    
    def __init__(self):
        self.coupon_id = None        # ì¿ í° ê³ ìœ  ID
        self.code = None             # ì¿ í° ì½”ë“œ
        self.name = None             # ì¿ í° ì´ë¦„
        self.description = None      # ì¿ í° ì„¤ëª…
        self.coupon_type = None      # ì¿ í° ìœ í˜•
        self.discount_type = None    # í• ì¸ ìœ í˜•
        self.discount_value = None   # í• ì¸ ê°’
        self.min_purchase_amount = 0 # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
        self.max_discount_amount = None # ìµœëŒ€ í• ì¸ ê¸ˆì•¡
        self.usage_limit = None      # ì‚¬ìš© íšŸìˆ˜ ì œí•œ
        self.used_count = 0          # ì‚¬ìš©ëœ íšŸìˆ˜
        self.start_date = None       # ì‹œì‘ ì¼ì‹œ
        self.end_date = None         # ì¢…ë£Œ ì¼ì‹œ
        self.target_users = []       # ëŒ€ìƒ ì‚¬ìš©ì (ë¹ˆ ë°°ì—´ì‹œ ì „ì²´)
        self.target_membership = []  # ëŒ€ìƒ íšŒì› ë“±ê¸‰
        self.is_active = True        # í™œì„± ìƒíƒœ
        self.created_by = None       # ìƒì„±ì (ê´€ë¦¬ì ID)
        self.created_at = None       # ìƒì„± ì¼ì‹œ

# ì¿ í° ìœ í˜• ì •ì˜
COUPON_TYPES = {
    'subscription_discount': 'êµ¬ë…ë£Œ í• ì¸',
    'commission_discount': 'ìˆ˜ìˆ˜ë£Œ í• ì¸', 
    'free_trial_extension': 'ë¬´ë£Œ ì²´í—˜ ì—°ì¥',
    'premium_upgrade': 'í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ',
    'lifetime_discount': 'ë¼ì´í”„íƒ€ì„ í• ì¸'
}

DISCOUNT_TYPES = {
    'percentage': 'í¼ì„¼íŠ¸ í• ì¸',
    'fixed_amount': 'ê³ ì • ê¸ˆì•¡ í• ì¸',
    'free_period': 'ë¬´ë£Œ ê¸°ê°„ ì œê³µ'
}

class CouponService:
    """ì¿ í° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤"""
    
    @staticmethod
    def create_coupon(admin_id, coupon_data):
        """ê´€ë¦¬ì ì¿ í° ìƒì„±"""
        import random
        import string
        from datetime import datetime
        
        coupon = Coupon()
        coupon.code = CouponService.generate_coupon_code()
        coupon.name = coupon_data['name']
        coupon.description = coupon_data['description']
        coupon.coupon_type = coupon_data['coupon_type']
        coupon.discount_type = coupon_data['discount_type']
        coupon.discount_value = coupon_data['discount_value']
        coupon.min_purchase_amount = coupon_data.get('min_purchase_amount', 0)
        coupon.max_discount_amount = coupon_data.get('max_discount_amount')
        coupon.usage_limit = coupon_data.get('usage_limit')
        coupon.start_date = coupon_data['start_date']
        coupon.end_date = coupon_data['end_date']
        coupon.target_users = coupon_data.get('target_users', [])
        coupon.target_membership = coupon_data.get('target_membership', [])
        coupon.created_by = admin_id
        coupon.created_at = datetime.now()
        
        return coupon.save()
    
    @staticmethod
    def generate_coupon_code():
        """ì¿ í° ì½”ë“œ ìƒì„± (12ìë¦¬)"""
        return ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=12
        ))
    
    @staticmethod
    def validate_coupon(code, user_id, purchase_amount=0):
        """ì¿ í° ìœ íš¨ì„± ê²€ì¦"""
        from datetime import datetime
        
        coupon = Coupon.get_by_code(code)
        if not coupon:
            return {'valid': False, 'reason': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # í™œì„± ìƒíƒœ í™•ì¸
        if not coupon.is_active:
            return {'valid': False, 'reason': 'ë¹„í™œì„±í™”ëœ ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # ê¸°ê°„ í™•ì¸
        now = datetime.now()
        if now < coupon.start_date or now > coupon.end_date:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ì‚¬ìš© íšŸìˆ˜ í™•ì¸
        if coupon.usage_limit and coupon.used_count >= coupon.usage_limit:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.'}
        
        # ëŒ€ìƒ ì‚¬ìš©ì í™•ì¸
        if coupon.target_users and user_id not in coupon.target_users:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ í™•ì¸
        if purchase_amount < coupon.min_purchase_amount:
            return {'valid': False, 'reason': f'ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ {coupon.min_purchase_amount:,}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'}
        
        # íšŒì› ë“±ê¸‰ í™•ì¸
        user = User.get_by_id(user_id)
        if coupon.target_membership and user.membership_type not in coupon.target_membership:
            return {'valid': False, 'reason': 'í•´ë‹¹ íšŒì› ë“±ê¸‰ì€ ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {'valid': True, 'coupon': coupon}
    
    @staticmethod
    def apply_coupon(coupon, user_id, purchase_amount):
        """ì¿ í° ì ìš©"""
        discount_amount = 0
        
        if coupon.discount_type == 'percentage':
            discount_amount = purchase_amount * (coupon.discount_value / 100)
            if coupon.max_discount_amount:
                discount_amount = min(discount_amount, coupon.max_discount_amount)
                
        elif coupon.discount_type == 'fixed_amount':
            discount_amount = coupon.discount_value
            
        elif coupon.discount_type == 'free_period':
            # ë¬´ë£Œ ê¸°ê°„ ì œê³µ ë¡œì§
            user = User.get_by_id(user_id)
            user.extend_free_period(coupon.discount_value)
            discount_amount = purchase_amount  # ì „ì•¡ í• ì¸
        
        # ì¿ í° ì‚¬ìš© ê¸°ë¡
        coupon.used_count += 1
        coupon.save()
        
        # ì‚¬ìš© ì´ë ¥ ì €ì¥
        CouponUsage.create({
            'coupon_id': coupon.coupon_id,
            'user_id': user_id,
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount,
            'used_at': datetime.now()
        })
        
        return {
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount
        }
```

### ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
```javascript
// AdminCouponManager.jsx
import React, { useState, useEffect } from 'react'
import {
  Box, Card, CardContent, Typography, Button, Dialog,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Chip, Grid, Alert, IconButton
} from '@mui/material'
import {
  Add, Edit, Delete, Visibility, GetApp
} from '@mui/icons-material'

function AdminCouponManager() {
  const [coupons, setCoupons] = useState([])
  const [createDialog, setCreateDialog] = useState(false)
  const [newCoupon, setNewCoupon] = useState({
    name: '',
    description: '',
    coupon_type: 'subscription_discount',
    discount_type: 'percentage',
    discount_value: '',
    min_purchase_amount: 0,
    max_discount_amount: '',
    usage_limit: '',
    start_date: '',
    end_date: '',
    target_membership: []
  })

  const handleCreateCoupon = async () => {
    try {
      const response = await fetch('/api/admin/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newCoupon)
      })
      
      if (response.ok) {
        const createdCoupon = await response.json()
        setCoupons([...coupons, createdCoupon])
        setCreateDialog(false)
        setNewCoupon({})
      }
    } catch (error) {
      console.error('ì¿ í° ìƒì„± ì‹¤íŒ¨:', error)
    }
  }

  const getCouponStatusColor = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'error'
    if (now < startDate) return 'warning'
    if (now > endDate) return 'default'
    return 'success'
  }

  const getCouponStatusText = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'ë¹„í™œì„±'
    if (now < startDate) return 'ëŒ€ê¸°ì¤‘'
    if (now > endDate) return 'ë§Œë£Œë¨'
    return 'í™œì„±'
  }

  return (
    <Box>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h5">ğŸ« ì¿ í° ê´€ë¦¬</Typography>
        <Button
          variant="contained"
          startIcon={<Add />}
          onClick={() => setCreateDialog(true)}
        >
          ì¿ í° ìƒì„±
        </Button>
      </Box>

      {/* ì¿ í° í†µê³„ */}
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="primary">
                {coupons.filter(c => c.is_active).length}
              </Typography>
              <Typography variant="body2">í™œì„± ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="success.main">
                {coupons.reduce((sum, c) => sum + c.used_count, 0)}
              </Typography>
              <Typography variant="body2">ì´ ì‚¬ìš© íšŸìˆ˜</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="warning.main">
                {coupons.filter(c => new Date() < new Date(c.start_date)).length}
              </Typography>
              <Typography variant="body2">ì˜ˆì•½ëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="error.main">
                {coupons.filter(c => new Date() > new Date(c.end_date)).length}
              </Typography>
              <Typography variant="body2">ë§Œë£Œëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* ì¿ í° ëª©ë¡ */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>ì¿ í°ëª…</TableCell>
                  <TableCell>ì½”ë“œ</TableCell>
                  <TableCell>ìœ í˜•</TableCell>
                  <TableCell>í• ì¸ê°’</TableCell>
                  <TableCell>ì‚¬ìš©íšŸìˆ˜</TableCell>
                  <TableCell>ê¸°ê°„</TableCell>
                  <TableCell>ìƒíƒœ</TableCell>
                  <TableCell>ê´€ë¦¬</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {coupons.map((coupon) => (
                  <TableRow key={coupon.coupon_id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {coupon.name}
                      </Typography>
                      <Typography variant="caption" color="textSecondary">
                        {coupon.description}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontFamily="monospace">
                        {coupon.code}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {coupon.coupon_type}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {coupon.discount_type === 'percentage' 
                        ? `${coupon.discount_value}%`
                        : `${coupon.discount_value:,}ì›`}
                    </TableCell>
                    <TableCell>
                      {coupon.used_count} / {coupon.usage_limit || 'ë¬´ì œí•œ'}
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {new Date(coupon.start_date).toLocaleDateString()} ~<br/>
                        {new Date(coupon.end_date).toLocaleDateString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip 
                        label={getCouponStatusText(coupon)}
                        color={getCouponStatusColor(coupon)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <IconButton size="small">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" color="error">
                        <Delete />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* ì¿ í° ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog 
        open={createDialog} 
        onClose={() => setCreateDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {/* ì¿ í° ìƒì„± í¼ êµ¬í˜„ */}
      </Dialog>
    </Box>
  )
}

export default AdminCouponManager
```

## ğŸ”„ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2A-Extended: íšŒì› ì‹œìŠ¤í…œ ê³ ë„í™” (D+1 ~ D+21)

#### Week 1: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ ìˆ˜ì •
```powershell
# 1. íšŒì› ëª¨ë¸ ì—…ë°ì´íŠ¸
# User ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
- free_trial_end_date    # ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼
- daily_trade_count      # ì¼ì¼ ê±°ë˜ íšŸìˆ˜
- total_extension_days   # ì´ ì—°ì¥ ì¼ìˆ˜
- referral_code          # ê°œì¸ ì´ˆëŒ€ ì½”ë“œ

# 2. ê±°ë˜ ì œí•œ ë¡œì§ êµ¬í˜„
# TradeControllerì—ì„œ íšŒì› ë“±ê¸‰ë³„ ì œí•œ ì²´í¬
```

#### Week 2: ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ
```powershell
# 1. ì´ˆëŒ€ ì½”ë“œ ìƒì„± ê¸°ëŠ¥
# ReferralCode ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„

# 2. ì´ˆëŒ€ ë§í¬ ì²˜ë¦¬
# íšŒì›ê°€ì… ì‹œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ë¡œì§

# 3. ë³´ìƒ ì§€ê¸‰ ì‹œìŠ¤í…œ
# ìë™ ì—°ì¥ ë° í•œë„ ê´€ë¦¬
```

#### Week 3: ì¿ í° ì‹œìŠ¤í…œ
```powershell
# 1. ì¿ í° ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„
# Coupon, CouponUsage ëª¨ë¸ ìƒì„±

# 2. ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
# AdminCouponManager ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

# 3. ì¿ í° ì ìš© ë¡œì§
# ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì´ˆëŒ€ ì½”ë“œ í…Œì´ë¸”
CREATE TABLE referral_codes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    code VARCHAR(8) UNIQUE NOT NULL,
    invite_url VARCHAR(255) NOT NULL,
    max_uses INT DEFAULT 50,
    current_uses INT DEFAULT 0,
    expires_at DATETIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì´ˆëŒ€ ë³´ìƒ í…Œì´ë¸”
CREATE TABLE referral_rewards (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    inviter_id BIGINT NOT NULL,
    invitee_id BIGINT NOT NULL,
    referral_code VARCHAR(8) NOT NULL,
    reward_days INT DEFAULT 7,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_at TIMESTAMP,
    is_claimed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (inviter_id) REFERENCES users(id),
    FOREIGN KEY (invitee_id) REFERENCES users(id)
);

-- ì¿ í° í…Œì´ë¸”
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(12) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    coupon_type ENUM('subscription_discount', 'commission_discount', 'free_trial_extension', 'premium_upgrade', 'lifetime_discount') NOT NULL,
    discount_type ENUM('percentage', 'fixed_amount', 'free_period') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2) DEFAULT 0,
    max_discount_amount DECIMAL(10,2),
    usage_limit INT,
    used_count INT DEFAULT 0,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    target_membership JSON,
    target_users JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ì¿ í° ì‚¬ìš© ì´ë ¥ í…Œì´ë¸”
CREATE TABLE coupon_usage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    original_amount DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) NOT NULL,
    final_amount DECIMAL(10,2) NOT NULL,
    used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì‚¬ìš©ì í…Œì´ë¸” ìˆ˜ì • (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
ALTER TABLE users ADD COLUMN free_trial_end_date DATETIME;
ALTER TABLE users ADD COLUMN daily_trade_count INT DEFAULT 0;
ALTER TABLE users ADD COLUMN daily_trade_reset_date DATE;
ALTER TABLE users ADD COLUMN total_extension_days INT DEFAULT 0;
ALTER TABLE users ADD COLUMN personal_referral_code VARCHAR(8) UNIQUE;
```

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### ê±°ë˜ ì œí•œ ê²€ì¦ ì„œë¹„ìŠ¤
```python
# services/TradingLimitService.py
class TradingLimitService:
    """ê±°ë˜ ì œí•œ ê´€ë¦¬ ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def can_make_trade(user_id, trade_type='demo'):
        """ê±°ë˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸"""
        user = User.get_by_id(user_id)
        
        # ë¹„íšŒì›ì€ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
        if not user or not user.is_authenticated:
            return {
                'allowed': False,
                'reason': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                'redirect_to': '/login'
            }
        
        # ë¼ì´í”„íƒ€ì„/í”„ë¦¬ë¯¸ì—„ íšŒì›ì€ ë¬´ì œí•œ
        if user.membership_type in ['lifetime', 'premium']:
            return {'allowed': True}
        
        # ë¬´ë£Œ íšŒì› ì œí•œ ë¡œì§
        if user.membership_type == 'free':
            # ì‹ ê·œ ê°€ì… 7ì¼ ë¬´ë£Œ ê¸°ê°„ í™•ì¸
            if user.is_in_free_trial():
                return {'allowed': True}
            
            # ì¼ì¼ ê±°ë˜ ì œí•œ í™•ì¸ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
            today_trades = user.get_today_trade_count()
            if today_trades >= 2:
                return {
                    'allowed': False,
                    'reason': 'ì¼ì¼ ê±°ë˜ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (2íšŒ/ì¼)',
                    'upgrade_suggested': True
                }
            
            # ì‹¤ì „ ê±°ë˜ëŠ” ì°¨ë‹¨
            if trade_type == 'real':
                return {
                    'allowed': False,
                    'reason': 'ì‹¤ì „ ê±°ë˜ëŠ” ìœ ë£Œ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    'upgrade_required': True
                }
        
        return {'allowed': True}
    
    @staticmethod
    def record_trade(user_id, trade_type):
        """ê±°ë˜ ê¸°ë¡"""
        user = User.get_by_id(user_id)
        
        if user.membership_type == 'free':
            # ì¼ì¼ ê±°ë˜ íšŸìˆ˜ ì¦ê°€
            from datetime import date
            today = date.today()
            
            if user.daily_trade_reset_date != today:
                user.daily_trade_count = 0
                user.daily_trade_reset_date = today
            
            user.daily_trade_count += 1
            user.save()
```

## ğŸ“± UI/UX ê°œì„ ì‚¬í•­

### íšŒì›ê°€ì… í”Œë¡œìš° ê°œì„ 
```javascript
// SignupFlow.jsx
function SignupFlow() {
  const [referralCode, setReferralCode] = useState('')
  const [step, setStep] = useState(1)
  
  useEffect(() => {
    // URLì—ì„œ ì´ˆëŒ€ ì½”ë“œ ì¶”ì¶œ
    const urlParams = new URLSearchParams(window.location.search)
    const refCode = urlParams.get('ref')
    if (refCode) {
      setReferralCode(refCode)
      // ì´ˆëŒ€ ì½”ë“œ ìœ íš¨ì„± ê²€ì¦
      validateReferralCode(refCode)
    }
  }, [])
  
  const handleSignup = async (userData) => {
    const signupData = {
      ...userData,
      referral_code: referralCode
    }
    
    const response = await signup(signupData)
    if (response.success) {
      // ì‹ ê·œ ê°€ì… í˜œíƒ ì•ˆë‚´
      showWelcomeDialog({
        freeTrialDays: 7,
        hasReferral: !!referralCode
      })
    }
  }
  
  return (
    <Box>
      {referralCode && (
        <Alert severity="success" sx={{ mb: 2 }}>
          ğŸ ì¹œêµ¬ ì´ˆëŒ€ë¡œ ê°€ì…í•˜ì‹œëŠ”êµ°ìš”! 7ì¼ ë¬´ë£Œ ì²´í—˜ + ì¶”ê°€ í˜œíƒì„ ë“œë¦½ë‹ˆë‹¤.
        </Alert>
      )}
      {/* ê°€ì… í¼ */}
    </Box>
  )
}
```

ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ëŸ¬í•œ ì‹œìŠ¤í…œë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

<function_calls>
<invoke name="run_terminal_cmd">
<parameter name="command">cd ..
</code_block_to_apply_changes_from>
</edit_instructions>


Assistant:<rewritten_file>
```
# Christmas í”„ë¡œì íŠ¸ - íšŒì› ë“±ê¸‰ ë° ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ì í™•ë³´ì™€ ìˆ˜ìµí™” ìµœì í™”ë¥¼ ìœ„í•œ íšŒì› ë“±ê¸‰ ì²´ê³„, ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ, ì¿ í° ì‹œìŠ¤í…œì„ ì„¤ê³„í•©ë‹ˆë‹¤.

## ğŸ‘¥ íšŒì› ë“±ê¸‰ ì²´ê³„ (ìˆ˜ì •)

### ğŸš« ë¹„íšŒì› (Guest)
```yaml
ì ‘ê·¼_ê¶Œí•œ:
  - ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
  - ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - íšŒì›ê°€ì… ì•ˆë‚´ í˜ì´ì§€

ì œí•œ_ì‚¬í•­:
  - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
  - ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€
  - ë°ëª¨ ëª¨ë“œë„ ì œê³µí•˜ì§€ ì•ŠìŒ
```

### ğŸ†“ ë¬´ë£Œ íšŒì› (Free Member)
```yaml
ê¸°ë³¸_í˜œíƒ:
  - ë§¤ì¼ ëª¨ì˜ íˆ¬ì ë§¤ë§¤ 2íšŒ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
  - ê¸°ë³¸ ì°¨íŠ¸ ì¡°íšŒ (ì œí•œì )
  - íˆ¬ì êµìœ¡ ì½˜í…ì¸  (ê¸°ì´ˆ ê³¼ì •ë§Œ)

ì‹ ê·œ_ê°€ì…_í˜œíƒ:
  - ìµœì´ˆ ê°€ì… í›„ 7ì¼ê°„ ë¬´ì œí•œ ëª¨ì˜ ë§¤ë§¤
  - 7ì¼ í›„ ì¼ì¼ 2íšŒ ì œí•œìœ¼ë¡œ ë³€ê²½
  - ìœ ë£Œ íšŒì› ì „í™˜ ì•ˆë‚´

ì œí•œ_ì‚¬í•­:
  - ì‹¤ì „ ê±°ë˜ ì™„ì „ ì°¨ë‹¨
  - API ì—°ë™ ë¶ˆê°€
  - ê³ ê¸‰ ë¶„ì„ ë„êµ¬ ì œí•œ
  - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì œí•œ
  - ë°±í…ŒìŠ¤íŒ… ë¶ˆê°€
```

### ğŸ’ í”„ë¦¬ë¯¸ì—„ íšŒì› (Premium Member)
```yaml
ì›”_êµ¬ë…_í˜œíƒ:
  - ìš”ê¸ˆ: $15/ì›”
  - ì‹¤ì „ ê±°ë˜ ë¬´ì œí•œ
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ: 1%
  - ëª¨ë“  ì°¨íŠ¸ ë° ì§€í‘œ ì´ìš©
  - ì‹¤ì‹œê°„ ì•Œë¦¼ (í…”ë ˆê·¸ë¨, ì´ë©”ì¼)
  - ë°±í…ŒìŠ¤íŒ… ê¸°ëŠ¥
  - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë¶„ì„
  - ìš°ì„  ê³ ê° ì§€ì›

ì¶”ê°€_ê¸°ëŠ¥:
  - API í‚¤ ê°œì¸ ì„¤ì •
  - ê³ ê¸‰ ë§¤ë§¤ ì „ëµ ì´ìš©
  - ì»¤ë®¤ë‹ˆí‹° ì „ì²´ ì ‘ê·¼
  - ì›”ê°„ íˆ¬ì ë¦¬í¬íŠ¸
```

### ğŸ† ë¼ì´í”„íƒ€ì„ íšŒì› (Lifetime Member)
```yaml
ì¼ì‹œë¶ˆ_í˜œíƒ:
  - ìš”ê¸ˆ: â‚©10,000,000 (í™˜ë¶ˆ ë¶ˆê°€)
  - ëª¨ë“  í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ ì™„ì „ ë©´ì œ
  - VIP ì „ìš© ê¸°ëŠ¥
  - ê°œì¸ ë§ì¶¤ ì „ëµ ì»¨ì„¤íŒ…
  - ë² íƒ€ ê¸°ëŠ¥ ìš°ì„  ì²´í—˜
  - ì „ìš© ê³ ê° ì§€ì› ì±„ë„
  - í‰ìƒ ì„œë¹„ìŠ¤ ë³´ì¥

íŠ¹ë³„_í˜œíƒ:
  - ì‹ ê·œ ê¸°ëŠ¥ ë¬´ë£Œ ì—…ê·¸ë ˆì´ë“œ
  - ì›”ê°„ ê°œì¸ íˆ¬ì ìƒë‹´
  - VIP ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼
  - ì—°ê°„ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜ ì°¸ì„ê¶Œ
```

## ğŸ ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ

### ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹œìŠ¤í…œ
```python
# models/ReferralCode.py
class ReferralCode:
    """ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ ëª¨ë¸"""
    
    def __init__(self):
        self.user_id = None          # ì´ˆëŒ€ì ID
        self.code = None             # 8ìë¦¬ ê³ ìœ  ì½”ë“œ
        self.invite_url = None       # ì´ˆëŒ€ ë§í¬ URL
        self.created_at = None       # ìƒì„± ì¼ì‹œ
        self.expires_at = None       # ë§Œë£Œ ì¼ì‹œ (90ì¼ í›„)
        self.max_uses = 50           # ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜
        self.current_uses = 0        # í˜„ì¬ ì‚¬ìš© íšŸìˆ˜
        self.is_active = True        # í™œì„± ìƒíƒœ
        
    def generate_code(self, user_id):
        """ê³ ìœ  ì´ˆëŒ€ ì½”ë“œ ìƒì„±"""
        import random
        import string
        from datetime import datetime, timedelta
        
        # 8ìë¦¬ ì˜ìˆ«ì ì¡°í•© ì½”ë“œ ìƒì„±
        self.code = ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=8
        ))
        
        self.user_id = user_id
        self.invite_url = f"https://christmas-trading.com/signup?ref={self.code}"
        self.created_at = datetime.now()
        self.expires_at = datetime.now() + timedelta(days=90)
        
        return self.code
    
    def is_valid(self):
        """ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬"""
        from datetime import datetime
        
        return (
            self.is_active and 
            self.current_uses < self.max_uses and
            datetime.now() < self.expires_at
        )

# models/ReferralReward.py
class ReferralReward:
    """ì´ˆëŒ€ ë³´ìƒ ëª¨ë¸"""
    
    def __init__(self):
        self.inviter_id = None       # ì´ˆëŒ€ì ID
        self.invitee_id = None       # í”¼ì´ˆëŒ€ì ID
        self.referral_code = None    # ì‚¬ìš©ëœ ì´ˆëŒ€ ì½”ë“œ
        self.reward_type = 'free_extension'  # ë³´ìƒ ìœ í˜•
        self.reward_days = 7         # ë³´ìƒ ì¼ìˆ˜
        self.created_at = None       # ë³´ìƒ ìƒì„± ì¼ì‹œ
        self.applied_at = None       # ë³´ìƒ ì ìš© ì¼ì‹œ
        self.is_claimed = False      # ë³´ìƒ ìˆ˜ë ¹ ì—¬ë¶€
        
    def apply_reward(self, inviter_id, invitee_id, code):
        """ì´ˆëŒ€ ë³´ìƒ ì ìš©"""
        from datetime import datetime
        
        self.inviter_id = inviter_id
        self.invitee_id = invitee_id
        self.referral_code = code
        self.created_at = datetime.now()
        
        # ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ë¶€ì—¬
        self.extend_membership(inviter_id, 7)
        self.is_claimed = True
        self.applied_at = datetime.now()
        
    def extend_membership(self, user_id, days):
        """íšŒì›ê¶Œ ì—°ì¥"""
        user = User.get_by_id(user_id)
        current_total_extension = self.get_total_extension_days(user_id)
        
        # ìµœëŒ€ 3ê°œì›”(90ì¼) ì œí•œ í™•ì¸
        if current_total_extension + days <= 90:
            user.extend_free_period(days)
            return True
        else:
            # 90ì¼ í•œë„ ì´ˆê³¼ì‹œ ë‚¨ì€ ì¼ìˆ˜ë§Œ ì—°ì¥
            remaining_days = 90 - current_total_extension
            if remaining_days > 0:
                user.extend_free_period(remaining_days)
            return False
```

### ì´ˆëŒ€ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°
```yaml
ì´ˆëŒ€_í”„ë¡œì„¸ìŠ¤:
  1. ì´ˆëŒ€ìê°€ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
  2. ì´ˆëŒ€ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ 
  3. ì¹œêµ¬ê°€ ë§í¬ë¥¼ í†µí•´ íšŒì›ê°€ì…
  4. ì‹œìŠ¤í…œì´ ì´ˆëŒ€ ê´€ê³„ í™•ì¸
  5. ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ìë™ ì§€ê¸‰
  6. í”¼ì´ˆëŒ€ìëŠ” ì‹ ê·œ ê°€ì… í˜œíƒ (7ì¼ ë¬´ë£Œ) ì œê³µ

ì œí•œ_ì‚¬í•­:
  - ì´ˆëŒ€ìë‹¹ ìµœëŒ€ ì—°ì¥ ê¸°ê°„: 3ê°œì›” (90ì¼)
  - ì½”ë“œ ìœ íš¨ ê¸°ê°„: 90ì¼
  - ì½”ë“œë‹¹ ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜: 50íšŒ
  - ìê°€ ì´ˆëŒ€ ë°©ì§€ ë¡œì§ êµ¬í˜„
```

## ğŸ« ì¿ í° ì‹œìŠ¤í…œ

### ì¿ í° ìœ í˜• ì„¤ê³„
```python
# models/Coupon.py
class Coupon:
    """ì¿ í° ì‹œìŠ¤í…œ ëª¨ë¸"""
    
    def __init__(self):
        self.coupon_id = None        # ì¿ í° ê³ ìœ  ID
        self.code = None             # ì¿ í° ì½”ë“œ
        self.name = None             # ì¿ í° ì´ë¦„
        self.description = None      # ì¿ í° ì„¤ëª…
        self.coupon_type = None      # ì¿ í° ìœ í˜•
        self.discount_type = None    # í• ì¸ ìœ í˜•
        self.discount_value = None   # í• ì¸ ê°’
        self.min_purchase_amount = 0 # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
        self.max_discount_amount = None # ìµœëŒ€ í• ì¸ ê¸ˆì•¡
        self.usage_limit = None      # ì‚¬ìš© íšŸìˆ˜ ì œí•œ
        self.used_count = 0          # ì‚¬ìš©ëœ íšŸìˆ˜
        self.start_date = None       # ì‹œì‘ ì¼ì‹œ
        self.end_date = None         # ì¢…ë£Œ ì¼ì‹œ
        self.target_users = []       # ëŒ€ìƒ ì‚¬ìš©ì (ë¹ˆ ë°°ì—´ì‹œ ì „ì²´)
        self.target_membership = []  # ëŒ€ìƒ íšŒì› ë“±ê¸‰
        self.is_active = True        # í™œì„± ìƒíƒœ
        self.created_by = None       # ìƒì„±ì (ê´€ë¦¬ì ID)
        self.created_at = None       # ìƒì„± ì¼ì‹œ

# ì¿ í° ìœ í˜• ì •ì˜
COUPON_TYPES = {
    'subscription_discount': 'êµ¬ë…ë£Œ í• ì¸',
    'commission_discount': 'ìˆ˜ìˆ˜ë£Œ í• ì¸', 
    'free_trial_extension': 'ë¬´ë£Œ ì²´í—˜ ì—°ì¥',
    'premium_upgrade': 'í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ',
    'lifetime_discount': 'ë¼ì´í”„íƒ€ì„ í• ì¸'
}

DISCOUNT_TYPES = {
    'percentage': 'í¼ì„¼íŠ¸ í• ì¸',
    'fixed_amount': 'ê³ ì • ê¸ˆì•¡ í• ì¸',
    'free_period': 'ë¬´ë£Œ ê¸°ê°„ ì œê³µ'
}

class CouponService:
    """ì¿ í° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤"""
    
    @staticmethod
    def create_coupon(admin_id, coupon_data):
        """ê´€ë¦¬ì ì¿ í° ìƒì„±"""
        import random
        import string
        from datetime import datetime
        
        coupon = Coupon()
        coupon.code = CouponService.generate_coupon_code()
        coupon.name = coupon_data['name']
        coupon.description = coupon_data['description']
        coupon.coupon_type = coupon_data['coupon_type']
        coupon.discount_type = coupon_data['discount_type']
        coupon.discount_value = coupon_data['discount_value']
        coupon.min_purchase_amount = coupon_data.get('min_purchase_amount', 0)
        coupon.max_discount_amount = coupon_data.get('max_discount_amount')
        coupon.usage_limit = coupon_data.get('usage_limit')
        coupon.start_date = coupon_data['start_date']
        coupon.end_date = coupon_data['end_date']
        coupon.target_users = coupon_data.get('target_users', [])
        coupon.target_membership = coupon_data.get('target_membership', [])
        coupon.created_by = admin_id
        coupon.created_at = datetime.now()
        
        return coupon.save()
    
    @staticmethod
    def generate_coupon_code():
        """ì¿ í° ì½”ë“œ ìƒì„± (12ìë¦¬)"""
        return ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=12
        ))
    
    @staticmethod
    def validate_coupon(code, user_id, purchase_amount=0):
        """ì¿ í° ìœ íš¨ì„± ê²€ì¦"""
        from datetime import datetime
        
        coupon = Coupon.get_by_code(code)
        if not coupon:
            return {'valid': False, 'reason': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # í™œì„± ìƒíƒœ í™•ì¸
        if not coupon.is_active:
            return {'valid': False, 'reason': 'ë¹„í™œì„±í™”ëœ ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # ê¸°ê°„ í™•ì¸
        now = datetime.now()
        if now < coupon.start_date or now > coupon.end_date:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ì‚¬ìš© íšŸìˆ˜ í™•ì¸
        if coupon.usage_limit and coupon.used_count >= coupon.usage_limit:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.'}
        
        # ëŒ€ìƒ ì‚¬ìš©ì í™•ì¸
        if coupon.target_users and user_id not in coupon.target_users:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ í™•ì¸
        if purchase_amount < coupon.min_purchase_amount:
            return {'valid': False, 'reason': f'ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ {coupon.min_purchase_amount:,}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'}
        
        # íšŒì› ë“±ê¸‰ í™•ì¸
        user = User.get_by_id(user_id)
        if coupon.target_membership and user.membership_type not in coupon.target_membership:
            return {'valid': False, 'reason': 'í•´ë‹¹ íšŒì› ë“±ê¸‰ì€ ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {'valid': True, 'coupon': coupon}
    
    @staticmethod
    def apply_coupon(coupon, user_id, purchase_amount):
        """ì¿ í° ì ìš©"""
        discount_amount = 0
        
        if coupon.discount_type == 'percentage':
            discount_amount = purchase_amount * (coupon.discount_value / 100)
            if coupon.max_discount_amount:
                discount_amount = min(discount_amount, coupon.max_discount_amount)
                
        elif coupon.discount_type == 'fixed_amount':
            discount_amount = coupon.discount_value
            
        elif coupon.discount_type == 'free_period':
            # ë¬´ë£Œ ê¸°ê°„ ì œê³µ ë¡œì§
            user = User.get_by_id(user_id)
            user.extend_free_period(coupon.discount_value)
            discount_amount = purchase_amount  # ì „ì•¡ í• ì¸
        
        # ì¿ í° ì‚¬ìš© ê¸°ë¡
        coupon.used_count += 1
        coupon.save()
        
        # ì‚¬ìš© ì´ë ¥ ì €ì¥
        CouponUsage.create({
            'coupon_id': coupon.coupon_id,
            'user_id': user_id,
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount,
            'used_at': datetime.now()
        })
        
        return {
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount
        }
```

### ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
```javascript
// AdminCouponManager.jsx
import React, { useState, useEffect } from 'react'
import {
  Box, Card, CardContent, Typography, Button, Dialog,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Chip, Grid, Alert, IconButton
} from '@mui/material'
import {
  Add, Edit, Delete, Visibility, GetApp
} from '@mui/icons-material'

function AdminCouponManager() {
  const [coupons, setCoupons] = useState([])
  const [createDialog, setCreateDialog] = useState(false)
  const [newCoupon, setNewCoupon] = useState({
    name: '',
    description: '',
    coupon_type: 'subscription_discount',
    discount_type: 'percentage',
    discount_value: '',
    min_purchase_amount: 0,
    max_discount_amount: '',
    usage_limit: '',
    start_date: '',
    end_date: '',
    target_membership: []
  })

  const handleCreateCoupon = async () => {
    try {
      const response = await fetch('/api/admin/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newCoupon)
      })
      
      if (response.ok) {
        const createdCoupon = await response.json()
        setCoupons([...coupons, createdCoupon])
        setCreateDialog(false)
        setNewCoupon({})
      }
    } catch (error) {
      console.error('ì¿ í° ìƒì„± ì‹¤íŒ¨:', error)
    }
  }

  const getCouponStatusColor = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'error'
    if (now < startDate) return 'warning'
    if (now > endDate) return 'default'
    return 'success'
  }

  const getCouponStatusText = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'ë¹„í™œì„±'
    if (now < startDate) return 'ëŒ€ê¸°ì¤‘'
    if (now > endDate) return 'ë§Œë£Œë¨'
    return 'í™œì„±'
  }

  return (
    <Box>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h5">ğŸ« ì¿ í° ê´€ë¦¬</Typography>
        <Button
          variant="contained"
          startIcon={<Add />}
          onClick={() => setCreateDialog(true)}
        >
          ì¿ í° ìƒì„±
        </Button>
      </Box>

      {/* ì¿ í° í†µê³„ */}
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="primary">
                {coupons.filter(c => c.is_active).length}
              </Typography>
              <Typography variant="body2">í™œì„± ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="success.main">
                {coupons.reduce((sum, c) => sum + c.used_count, 0)}
              </Typography>
              <Typography variant="body2">ì´ ì‚¬ìš© íšŸìˆ˜</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="warning.main">
                {coupons.filter(c => new Date() < new Date(c.start_date)).length}
              </Typography>
              <Typography variant="body2">ì˜ˆì•½ëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="error.main">
                {coupons.filter(c => new Date() > new Date(c.end_date)).length}
              </Typography>
              <Typography variant="body2">ë§Œë£Œëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* ì¿ í° ëª©ë¡ */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>ì¿ í°ëª…</TableCell>
                  <TableCell>ì½”ë“œ</TableCell>
                  <TableCell>ìœ í˜•</TableCell>
                  <TableCell>í• ì¸ê°’</TableCell>
                  <TableCell>ì‚¬ìš©íšŸìˆ˜</TableCell>
                  <TableCell>ê¸°ê°„</TableCell>
                  <TableCell>ìƒíƒœ</TableCell>
                  <TableCell>ê´€ë¦¬</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {coupons.map((coupon) => (
                  <TableRow key={coupon.coupon_id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {coupon.name}
                      </Typography>
                      <Typography variant="caption" color="textSecondary">
                        {coupon.description}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontFamily="monospace">
                        {coupon.code}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {coupon.coupon_type}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {coupon.discount_type === 'percentage' 
                        ? `${coupon.discount_value}%`
                        : `${coupon.discount_value:,}ì›`}
                    </TableCell>
                    <TableCell>
                      {coupon.used_count} / {coupon.usage_limit || 'ë¬´ì œí•œ'}
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {new Date(coupon.start_date).toLocaleDateString()} ~<br/>
                        {new Date(coupon.end_date).toLocaleDateString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip 
                        label={getCouponStatusText(coupon)}
                        color={getCouponStatusColor(coupon)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <IconButton size="small">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" color="error">
                        <Delete />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* ì¿ í° ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog 
        open={createDialog} 
        onClose={() => setCreateDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {/* ì¿ í° ìƒì„± í¼ êµ¬í˜„ */}
      </Dialog>
    </Box>
  )
}

export default AdminCouponManager
```

## ğŸ”„ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2A-Extended: íšŒì› ì‹œìŠ¤í…œ ê³ ë„í™” (D+1 ~ D+21)

#### Week 1: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ ìˆ˜ì •
```powershell
# 1. íšŒì› ëª¨ë¸ ì—…ë°ì´íŠ¸
# User ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
- free_trial_end_date    # ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼
- daily_trade_count      # ì¼ì¼ ê±°ë˜ íšŸìˆ˜
- total_extension_days   # ì´ ì—°ì¥ ì¼ìˆ˜
- referral_code          # ê°œì¸ ì´ˆëŒ€ ì½”ë“œ

# 2. ê±°ë˜ ì œí•œ ë¡œì§ êµ¬í˜„
# TradeControllerì—ì„œ íšŒì› ë“±ê¸‰ë³„ ì œí•œ ì²´í¬
```

#### Week 2: ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ
```powershell
# 1. ì´ˆëŒ€ ì½”ë“œ ìƒì„± ê¸°ëŠ¥
# ReferralCode ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„

# 2. ì´ˆëŒ€ ë§í¬ ì²˜ë¦¬
# íšŒì›ê°€ì… ì‹œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ë¡œì§

# 3. ë³´ìƒ ì§€ê¸‰ ì‹œìŠ¤í…œ
# ìë™ ì—°ì¥ ë° í•œë„ ê´€ë¦¬
```

#### Week 3: ì¿ í° ì‹œìŠ¤í…œ
```powershell
# 1. ì¿ í° ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„
# Coupon, CouponUsage ëª¨ë¸ ìƒì„±

# 2. ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
# AdminCouponManager ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

# 3. ì¿ í° ì ìš© ë¡œì§
# ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì´ˆëŒ€ ì½”ë“œ í…Œì´ë¸”
CREATE TABLE referral_codes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    code VARCHAR(8) UNIQUE NOT NULL,
    invite_url VARCHAR(255) NOT NULL,
    max_uses INT DEFAULT 50,
    current_uses INT DEFAULT 0,
    expires_at DATETIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì´ˆëŒ€ ë³´ìƒ í…Œì´ë¸”
CREATE TABLE referral_rewards (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    inviter_id BIGINT NOT NULL,
    invitee_id BIGINT NOT NULL,
    referral_code VARCHAR(8) NOT NULL,
    reward_days INT DEFAULT 7,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_at TIMESTAMP,
    is_claimed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (inviter_id) REFERENCES users(id),
    FOREIGN KEY (invitee_id) REFERENCES users(id)
);

-- ì¿ í° í…Œì´ë¸”
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(12) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    coupon_type ENUM('subscription_discount', 'commission_discount', 'free_trial_extension', 'premium_upgrade', 'lifetime_discount') NOT NULL,
    discount_type ENUM('percentage', 'fixed_amount', 'free_period') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2) DEFAULT 0,
    max_discount_amount DECIMAL(10,2),
    usage_limit INT,
    used_count INT DEFAULT 0,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    target_membership JSON,
    target_users JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ì¿ í° ì‚¬ìš© ì´ë ¥ í…Œì´ë¸”
CREATE TABLE coupon_usage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    original_amount DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) NOT NULL,
    final_amount DECIMAL(10,2) NOT NULL,
    used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì‚¬ìš©ì í…Œì´ë¸” ìˆ˜ì • (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
ALTER TABLE users ADD COLUMN free_trial_end_date DATETIME;
ALTER TABLE users ADD COLUMN daily_trade_count INT DEFAULT 0;
ALTER TABLE users ADD COLUMN daily_trade_reset_date DATE;
ALTER TABLE users ADD COLUMN total_extension_days INT DEFAULT 0;
ALTER TABLE users ADD COLUMN personal_referral_code VARCHAR(8) UNIQUE;
```

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### ê±°ë˜ ì œí•œ ê²€ì¦ ì„œë¹„ìŠ¤
```python
# services/TradingLimitService.py
class TradingLimitService:
    """ê±°ë˜ ì œí•œ ê´€ë¦¬ ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def can_make_trade(user_id, trade_type='demo'):
        """ê±°ë˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸"""
        user = User.get_by_id(user_id)
        
        # ë¹„íšŒì›ì€ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
        if not user or not user.is_authenticated:
            return {
                'allowed': False,
                'reason': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                'redirect_to': '/login'
            }
        
        # ë¼ì´í”„íƒ€ì„/í”„ë¦¬ë¯¸ì—„ íšŒì›ì€ ë¬´ì œí•œ
        if user.membership_type in ['lifetime', 'premium']:
            return {'allowed': True}
        
        # ë¬´ë£Œ íšŒì› ì œí•œ ë¡œì§
        if user.membership_type == 'free':
            # ì‹ ê·œ ê°€ì… 7ì¼ ë¬´ë£Œ ê¸°ê°„ í™•ì¸
            if user.is_in_free_trial():
                return {'allowed': True}
            
            # ì¼ì¼ ê±°ë˜ ì œí•œ í™•ì¸ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
            today_trades = user.get_today_trade_count()
            if today_trades >= 2:
                return {
                    'allowed': False,
                    'reason': 'ì¼ì¼ ê±°ë˜ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (2íšŒ/ì¼)',
                    'upgrade_suggested': True
                }
            
            # ì‹¤ì „ ê±°ë˜ëŠ” ì°¨ë‹¨
            if trade_type == 'real':
                return {
                    'allowed': False,
                    'reason': 'ì‹¤ì „ ê±°ë˜ëŠ” ìœ ë£Œ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    'upgrade_required': True
                }
        
        return {'allowed': True}
    
    @staticmethod
    def record_trade(user_id, trade_type):
        """ê±°ë˜ ê¸°ë¡"""
        user = User.get_by_id(user_id)
        
        if user.membership_type == 'free':
            # ì¼ì¼ ê±°ë˜ íšŸìˆ˜ ì¦ê°€
            from datetime import date
            today = date.today()
            
            if user.daily_trade_reset_date != today:
                user.daily_trade_count = 0
                user.daily_trade_reset_date = today
            
            user.daily_trade_count += 1
            user.save()
```

## ğŸ“± UI/UX ê°œì„ ì‚¬í•­

### íšŒì›ê°€ì… í”Œë¡œìš° ê°œì„ 
```javascript
// SignupFlow.jsx
function SignupFlow() {
  const [referralCode, setReferralCode] = useState('')
  const [step, setStep] = useState(1)
  
  useEffect(() => {
    // URLì—ì„œ ì´ˆëŒ€ ì½”ë“œ ì¶”ì¶œ
    const urlParams = new URLSearchParams(window.location.search)
    const refCode = urlParams.get('ref')
    if (refCode) {
      setReferralCode(refCode)
      // ì´ˆëŒ€ ì½”ë“œ ìœ íš¨ì„± ê²€ì¦
      validateReferralCode(refCode)
    }
  }, [])
  
  const handleSignup = async (userData) => {
    const signupData = {
      ...userData,
      referral_code: referralCode
    }
    
    const response = await signup(signupData)
    if (response.success) {
      // ì‹ ê·œ ê°€ì… í˜œíƒ ì•ˆë‚´
      showWelcomeDialog({
        freeTrialDays: 7,
        hasReferral: !!referralCode
      })
    }
  }
  
  return (
    <Box>
      {referralCode && (
        <Alert severity="success" sx={{ mb: 2 }}>
          ğŸ ì¹œêµ¬ ì´ˆëŒ€ë¡œ ê°€ì…í•˜ì‹œëŠ”êµ°ìš”! 7ì¼ ë¬´ë£Œ ì²´í—˜ + ì¶”ê°€ í˜œíƒì„ ë“œë¦½ë‹ˆë‹¤.
        </Alert>
      )}
      {/* ê°€ì… í¼ */}
    </Box>
  )
}
```

ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ëŸ¬í•œ ì‹œìŠ¤í…œë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

<function_calls>
<invoke name="run_terminal_cmd">
<parameter name="command">cd ..
</code_block_to_apply_changes_from>
</edit_instructions>


Assistant:<rewritten_file>
```
# Christmas í”„ë¡œì íŠ¸ - íšŒì› ë“±ê¸‰ ë° ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ì í™•ë³´ì™€ ìˆ˜ìµí™” ìµœì í™”ë¥¼ ìœ„í•œ íšŒì› ë“±ê¸‰ ì²´ê³„, ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ, ì¿ í° ì‹œìŠ¤í…œì„ ì„¤ê³„í•©ë‹ˆë‹¤.

## ğŸ‘¥ íšŒì› ë“±ê¸‰ ì²´ê³„ (ìˆ˜ì •)

### ğŸš« ë¹„íšŒì› (Guest)
```yaml
ì ‘ê·¼_ê¶Œí•œ:
  - ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
  - ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - íšŒì›ê°€ì… ì•ˆë‚´ í˜ì´ì§€

ì œí•œ_ì‚¬í•­:
  - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
  - ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€
  - ë°ëª¨ ëª¨ë“œë„ ì œê³µí•˜ì§€ ì•ŠìŒ
```

### ğŸ†“ ë¬´ë£Œ íšŒì› (Free Member)
```yaml
ê¸°ë³¸_í˜œíƒ:
  - ë§¤ì¼ ëª¨ì˜ íˆ¬ì ë§¤ë§¤ 2íšŒ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
  - ê¸°ë³¸ ì°¨íŠ¸ ì¡°íšŒ (ì œí•œì )
  - íˆ¬ì êµìœ¡ ì½˜í…ì¸  (ê¸°ì´ˆ ê³¼ì •ë§Œ)

ì‹ ê·œ_ê°€ì…_í˜œíƒ:
  - ìµœì´ˆ ê°€ì… í›„ 7ì¼ê°„ ë¬´ì œí•œ ëª¨ì˜ ë§¤ë§¤
  - 7ì¼ í›„ ì¼ì¼ 2íšŒ ì œí•œìœ¼ë¡œ ë³€ê²½
  - ìœ ë£Œ íšŒì› ì „í™˜ ì•ˆë‚´

ì œí•œ_ì‚¬í•­:
  - ì‹¤ì „ ê±°ë˜ ì™„ì „ ì°¨ë‹¨
  - API ì—°ë™ ë¶ˆê°€
  - ê³ ê¸‰ ë¶„ì„ ë„êµ¬ ì œí•œ
  - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì œí•œ
  - ë°±í…ŒìŠ¤íŒ… ë¶ˆê°€
```

### ğŸ’ í”„ë¦¬ë¯¸ì—„ íšŒì› (Premium Member)
```yaml
ì›”_êµ¬ë…_í˜œíƒ:
  - ìš”ê¸ˆ: $15/ì›”
  - ì‹¤ì „ ê±°ë˜ ë¬´ì œí•œ
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ: 1%
  - ëª¨ë“  ì°¨íŠ¸ ë° ì§€í‘œ ì´ìš©
  - ì‹¤ì‹œê°„ ì•Œë¦¼ (í…”ë ˆê·¸ë¨, ì´ë©”ì¼)
  - ë°±í…ŒìŠ¤íŒ… ê¸°ëŠ¥
  - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë¶„ì„
  - ìš°ì„  ê³ ê° ì§€ì›

ì¶”ê°€_ê¸°ëŠ¥:
  - API í‚¤ ê°œì¸ ì„¤ì •
  - ê³ ê¸‰ ë§¤ë§¤ ì „ëµ ì´ìš©
  - ì»¤ë®¤ë‹ˆí‹° ì „ì²´ ì ‘ê·¼
  - ì›”ê°„ íˆ¬ì ë¦¬í¬íŠ¸
```

### ğŸ† ë¼ì´í”„íƒ€ì„ íšŒì› (Lifetime Member)
```yaml
ì¼ì‹œë¶ˆ_í˜œíƒ:
  - ìš”ê¸ˆ: â‚©10,000,000 (í™˜ë¶ˆ ë¶ˆê°€)
  - ëª¨ë“  í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ ì™„ì „ ë©´ì œ
  - VIP ì „ìš© ê¸°ëŠ¥
  - ê°œì¸ ë§ì¶¤ ì „ëµ ì»¨ì„¤íŒ…
  - ë² íƒ€ ê¸°ëŠ¥ ìš°ì„  ì²´í—˜
  - ì „ìš© ê³ ê° ì§€ì› ì±„ë„
  - í‰ìƒ ì„œë¹„ìŠ¤ ë³´ì¥

íŠ¹ë³„_í˜œíƒ:
  - ì‹ ê·œ ê¸°ëŠ¥ ë¬´ë£Œ ì—…ê·¸ë ˆì´ë“œ
  - ì›”ê°„ ê°œì¸ íˆ¬ì ìƒë‹´
  - VIP ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼
  - ì—°ê°„ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜ ì°¸ì„ê¶Œ
```

## ğŸ ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ

### ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹œìŠ¤í…œ
```python
# models/ReferralCode.py
class ReferralCode:
    """ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ ëª¨ë¸"""
    
    def __init__(self):
        self.user_id = None          # ì´ˆëŒ€ì ID
        self.code = None             # 8ìë¦¬ ê³ ìœ  ì½”ë“œ
        self.invite_url = None       # ì´ˆëŒ€ ë§í¬ URL
        self.created_at = None       # ìƒì„± ì¼ì‹œ
        self.expires_at = None       # ë§Œë£Œ ì¼ì‹œ (90ì¼ í›„)
        self.max_uses = 50           # ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜
        self.current_uses = 0        # í˜„ì¬ ì‚¬ìš© íšŸìˆ˜
        self.is_active = True        # í™œì„± ìƒíƒœ
        
    def generate_code(self, user_id):
        """ê³ ìœ  ì´ˆëŒ€ ì½”ë“œ ìƒì„±"""
        import random
        import string
        from datetime import datetime, timedelta
        
        # 8ìë¦¬ ì˜ìˆ«ì ì¡°í•© ì½”ë“œ ìƒì„±
        self.code = ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=8
        ))
        
        self.user_id = user_id
        self.invite_url = f"https://christmas-trading.com/signup?ref={self.code}"
        self.created_at = datetime.now()
        self.expires_at = datetime.now() + timedelta(days=90)
        
        return self.code
    
    def is_valid(self):
        """ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬"""
        from datetime import datetime
        
        return (
            self.is_active and 
            self.current_uses < self.max_uses and
            datetime.now() < self.expires_at
        )

# models/ReferralReward.py
class ReferralReward:
    """ì´ˆëŒ€ ë³´ìƒ ëª¨ë¸"""
    
    def __init__(self):
        self.inviter_id = None       # ì´ˆëŒ€ì ID
        self.invitee_id = None       # í”¼ì´ˆëŒ€ì ID
        self.referral_code = None    # ì‚¬ìš©ëœ ì´ˆëŒ€ ì½”ë“œ
        self.reward_type = 'free_extension'  # ë³´ìƒ ìœ í˜•
        self.reward_days = 7         # ë³´ìƒ ì¼ìˆ˜
        self.created_at = None       # ë³´ìƒ ìƒì„± ì¼ì‹œ
        self.applied_at = None       # ë³´ìƒ ì ìš© ì¼ì‹œ
        self.is_claimed = False      # ë³´ìƒ ìˆ˜ë ¹ ì—¬ë¶€
        
    def apply_reward(self, inviter_id, invitee_id, code):
        """ì´ˆëŒ€ ë³´ìƒ ì ìš©"""
        from datetime import datetime
        
        self.inviter_id = inviter_id
        self.invitee_id = invitee_id
        self.referral_code = code
        self.created_at = datetime.now()
        
        # ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ë¶€ì—¬
        self.extend_membership(inviter_id, 7)
        self.is_claimed = True
        self.applied_at = datetime.now()
        
    def extend_membership(self, user_id, days):
        """íšŒì›ê¶Œ ì—°ì¥"""
        user = User.get_by_id(user_id)
        current_total_extension = self.get_total_extension_days(user_id)
        
        # ìµœëŒ€ 3ê°œì›”(90ì¼) ì œí•œ í™•ì¸
        if current_total_extension + days <= 90:
            user.extend_free_period(days)
            return True
        else:
            # 90ì¼ í•œë„ ì´ˆê³¼ì‹œ ë‚¨ì€ ì¼ìˆ˜ë§Œ ì—°ì¥
            remaining_days = 90 - current_total_extension
            if remaining_days > 0:
                user.extend_free_period(remaining_days)
            return False
```

### ì´ˆëŒ€ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°
```yaml
ì´ˆëŒ€_í”„ë¡œì„¸ìŠ¤:
  1. ì´ˆëŒ€ìê°€ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
  2. ì´ˆëŒ€ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ 
  3. ì¹œêµ¬ê°€ ë§í¬ë¥¼ í†µí•´ íšŒì›ê°€ì…
  4. ì‹œìŠ¤í…œì´ ì´ˆëŒ€ ê´€ê³„ í™•ì¸
  5. ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ìë™ ì§€ê¸‰
  6. í”¼ì´ˆëŒ€ìëŠ” ì‹ ê·œ ê°€ì… í˜œíƒ (7ì¼ ë¬´ë£Œ) ì œê³µ

ì œí•œ_ì‚¬í•­:
  - ì´ˆëŒ€ìë‹¹ ìµœëŒ€ ì—°ì¥ ê¸°ê°„: 3ê°œì›” (90ì¼)
  - ì½”ë“œ ìœ íš¨ ê¸°ê°„: 90ì¼
  - ì½”ë“œë‹¹ ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜: 50íšŒ
  - ìê°€ ì´ˆëŒ€ ë°©ì§€ ë¡œì§ êµ¬í˜„
```

## ğŸ« ì¿ í° ì‹œìŠ¤í…œ

### ì¿ í° ìœ í˜• ì„¤ê³„
```python
# models/Coupon.py
class Coupon:
    """ì¿ í° ì‹œìŠ¤í…œ ëª¨ë¸"""
    
    def __init__(self):
        self.coupon_id = None        # ì¿ í° ê³ ìœ  ID
        self.code = None             # ì¿ í° ì½”ë“œ
        self.name = None             # ì¿ í° ì´ë¦„
        self.description = None      # ì¿ í° ì„¤ëª…
        self.coupon_type = None      # ì¿ í° ìœ í˜•
        self.discount_type = None    # í• ì¸ ìœ í˜•
        self.discount_value = None   # í• ì¸ ê°’
        self.min_purchase_amount = 0 # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
        self.max_discount_amount = None # ìµœëŒ€ í• ì¸ ê¸ˆì•¡
        self.usage_limit = None      # ì‚¬ìš© íšŸìˆ˜ ì œí•œ
        self.used_count = 0          # ì‚¬ìš©ëœ íšŸìˆ˜
        self.start_date = None       # ì‹œì‘ ì¼ì‹œ
        self.end_date = None         # ì¢…ë£Œ ì¼ì‹œ
        self.target_users = []       # ëŒ€ìƒ ì‚¬ìš©ì (ë¹ˆ ë°°ì—´ì‹œ ì „ì²´)
        self.target_membership = []  # ëŒ€ìƒ íšŒì› ë“±ê¸‰
        self.is_active = True        # í™œì„± ìƒíƒœ
        self.created_by = None       # ìƒì„±ì (ê´€ë¦¬ì ID)
        self.created_at = None       # ìƒì„± ì¼ì‹œ

# ì¿ í° ìœ í˜• ì •ì˜
COUPON_TYPES = {
    'subscription_discount': 'êµ¬ë…ë£Œ í• ì¸',
    'commission_discount': 'ìˆ˜ìˆ˜ë£Œ í• ì¸', 
    'free_trial_extension': 'ë¬´ë£Œ ì²´í—˜ ì—°ì¥',
    'premium_upgrade': 'í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ',
    'lifetime_discount': 'ë¼ì´í”„íƒ€ì„ í• ì¸'
}

DISCOUNT_TYPES = {
    'percentage': 'í¼ì„¼íŠ¸ í• ì¸',
    'fixed_amount': 'ê³ ì • ê¸ˆì•¡ í• ì¸',
    'free_period': 'ë¬´ë£Œ ê¸°ê°„ ì œê³µ'
}

class CouponService:
    """ì¿ í° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤"""
    
    @staticmethod
    def create_coupon(admin_id, coupon_data):
        """ê´€ë¦¬ì ì¿ í° ìƒì„±"""
        import random
        import string
        from datetime import datetime
        
        coupon = Coupon()
        coupon.code = CouponService.generate_coupon_code()
        coupon.name = coupon_data['name']
        coupon.description = coupon_data['description']
        coupon.coupon_type = coupon_data['coupon_type']
        coupon.discount_type = coupon_data['discount_type']
        coupon.discount_value = coupon_data['discount_value']
        coupon.min_purchase_amount = coupon_data.get('min_purchase_amount', 0)
        coupon.max_discount_amount = coupon_data.get('max_discount_amount')
        coupon.usage_limit = coupon_data.get('usage_limit')
        coupon.start_date = coupon_data['start_date']
        coupon.end_date = coupon_data['end_date']
        coupon.target_users = coupon_data.get('target_users', [])
        coupon.target_membership = coupon_data.get('target_membership', [])
        coupon.created_by = admin_id
        coupon.created_at = datetime.now()
        
        return coupon.save()
    
    @staticmethod
    def generate_coupon_code():
        """ì¿ í° ì½”ë“œ ìƒì„± (12ìë¦¬)"""
        return ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=12
        ))
    
    @staticmethod
    def validate_coupon(code, user_id, purchase_amount=0):
        """ì¿ í° ìœ íš¨ì„± ê²€ì¦"""
        from datetime import datetime
        
        coupon = Coupon.get_by_code(code)
        if not coupon:
            return {'valid': False, 'reason': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # í™œì„± ìƒíƒœ í™•ì¸
        if not coupon.is_active:
            return {'valid': False, 'reason': 'ë¹„í™œì„±í™”ëœ ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # ê¸°ê°„ í™•ì¸
        now = datetime.now()
        if now < coupon.start_date or now > coupon.end_date:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ì‚¬ìš© íšŸìˆ˜ í™•ì¸
        if coupon.usage_limit and coupon.used_count >= coupon.usage_limit:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.'}
        
        # ëŒ€ìƒ ì‚¬ìš©ì í™•ì¸
        if coupon.target_users and user_id not in coupon.target_users:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ í™•ì¸
        if purchase_amount < coupon.min_purchase_amount:
            return {'valid': False, 'reason': f'ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ {coupon.min_purchase_amount:,}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'}
        
        # íšŒì› ë“±ê¸‰ í™•ì¸
        user = User.get_by_id(user_id)
        if coupon.target_membership and user.membership_type not in coupon.target_membership:
            return {'valid': False, 'reason': 'í•´ë‹¹ íšŒì› ë“±ê¸‰ì€ ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {'valid': True, 'coupon': coupon}
    
    @staticmethod
    def apply_coupon(coupon, user_id, purchase_amount):
        """ì¿ í° ì ìš©"""
        discount_amount = 0
        
        if coupon.discount_type == 'percentage':
            discount_amount = purchase_amount * (coupon.discount_value / 100)
            if coupon.max_discount_amount:
                discount_amount = min(discount_amount, coupon.max_discount_amount)
                
        elif coupon.discount_type == 'fixed_amount':
            discount_amount = coupon.discount_value
            
        elif coupon.discount_type == 'free_period':
            # ë¬´ë£Œ ê¸°ê°„ ì œê³µ ë¡œì§
            user = User.get_by_id(user_id)
            user.extend_free_period(coupon.discount_value)
            discount_amount = purchase_amount  # ì „ì•¡ í• ì¸
        
        # ì¿ í° ì‚¬ìš© ê¸°ë¡
        coupon.used_count += 1
        coupon.save()
        
        # ì‚¬ìš© ì´ë ¥ ì €ì¥
        CouponUsage.create({
            'coupon_id': coupon.coupon_id,
            'user_id': user_id,
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount,
            'used_at': datetime.now()
        })
        
        return {
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount
        }
```

### ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
```javascript
// AdminCouponManager.jsx
import React, { useState, useEffect } from 'react'
import {
  Box, Card, CardContent, Typography, Button, Dialog,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Chip, Grid, Alert, IconButton
} from '@mui/material'
import {
  Add, Edit, Delete, Visibility, GetApp
} from '@mui/icons-material'

function AdminCouponManager() {
  const [coupons, setCoupons] = useState([])
  const [createDialog, setCreateDialog] = useState(false)
  const [newCoupon, setNewCoupon] = useState({
    name: '',
    description: '',
    coupon_type: 'subscription_discount',
    discount_type: 'percentage',
    discount_value: '',
    min_purchase_amount: 0,
    max_discount_amount: '',
    usage_limit: '',
    start_date: '',
    end_date: '',
    target_membership: []
  })

  const handleCreateCoupon = async () => {
    try {
      const response = await fetch('/api/admin/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newCoupon)
      })
      
      if (response.ok) {
        const createdCoupon = await response.json()
        setCoupons([...coupons, createdCoupon])
        setCreateDialog(false)
        setNewCoupon({})
      }
    } catch (error) {
      console.error('ì¿ í° ìƒì„± ì‹¤íŒ¨:', error)
    }
  }

  const getCouponStatusColor = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'error'
    if (now < startDate) return 'warning'
    if (now > endDate) return 'default'
    return 'success'
  }

  const getCouponStatusText = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'ë¹„í™œì„±'
    if (now < startDate) return 'ëŒ€ê¸°ì¤‘'
    if (now > endDate) return 'ë§Œë£Œë¨'
    return 'í™œì„±'
  }

  return (
    <Box>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h5">ğŸ« ì¿ í° ê´€ë¦¬</Typography>
        <Button
          variant="contained"
          startIcon={<Add />}
          onClick={() => setCreateDialog(true)}
        >
          ì¿ í° ìƒì„±
        </Button>
      </Box>

      {/* ì¿ í° í†µê³„ */}
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="primary">
                {coupons.filter(c => c.is_active).length}
              </Typography>
              <Typography variant="body2">í™œì„± ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="success.main">
                {coupons.reduce((sum, c) => sum + c.used_count, 0)}
              </Typography>
              <Typography variant="body2">ì´ ì‚¬ìš© íšŸìˆ˜</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="warning.main">
                {coupons.filter(c => new Date() < new Date(c.start_date)).length}
              </Typography>
              <Typography variant="body2">ì˜ˆì•½ëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="error.main">
                {coupons.filter(c => new Date() > new Date(c.end_date)).length}
              </Typography>
              <Typography variant="body2">ë§Œë£Œëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* ì¿ í° ëª©ë¡ */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>ì¿ í°ëª…</TableCell>
                  <TableCell>ì½”ë“œ</TableCell>
                  <TableCell>ìœ í˜•</TableCell>
                  <TableCell>í• ì¸ê°’</TableCell>
                  <TableCell>ì‚¬ìš©íšŸìˆ˜</TableCell>
                  <TableCell>ê¸°ê°„</TableCell>
                  <TableCell>ìƒíƒœ</TableCell>
                  <TableCell>ê´€ë¦¬</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {coupons.map((coupon) => (
                  <TableRow key={coupon.coupon_id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {coupon.name}
                      </Typography>
                      <Typography variant="caption" color="textSecondary">
                        {coupon.description}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontFamily="monospace">
                        {coupon.code}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {coupon.coupon_type}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {coupon.discount_type === 'percentage' 
                        ? `${coupon.discount_value}%`
                        : `${coupon.discount_value:,}ì›`}
                    </TableCell>
                    <TableCell>
                      {coupon.used_count} / {coupon.usage_limit || 'ë¬´ì œí•œ'}
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {new Date(coupon.start_date).toLocaleDateString()} ~<br/>
                        {new Date(coupon.end_date).toLocaleDateString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip 
                        label={getCouponStatusText(coupon)}
                        color={getCouponStatusColor(coupon)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <IconButton size="small">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" color="error">
                        <Delete />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* ì¿ í° ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog 
        open={createDialog} 
        onClose={() => setCreateDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {/* ì¿ í° ìƒì„± í¼ êµ¬í˜„ */}
      </Dialog>
    </Box>
  )
}

export default AdminCouponManager
```

## ğŸ”„ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2A-Extended: íšŒì› ì‹œìŠ¤í…œ ê³ ë„í™” (D+1 ~ D+21)

#### Week 1: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ ìˆ˜ì •
```powershell
# 1. íšŒì› ëª¨ë¸ ì—…ë°ì´íŠ¸
# User ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
- free_trial_end_date    # ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼
- daily_trade_count      # ì¼ì¼ ê±°ë˜ íšŸìˆ˜
- total_extension_days   # ì´ ì—°ì¥ ì¼ìˆ˜
- referral_code          # ê°œì¸ ì´ˆëŒ€ ì½”ë“œ

# 2. ê±°ë˜ ì œí•œ ë¡œì§ êµ¬í˜„
# TradeControllerì—ì„œ íšŒì› ë“±ê¸‰ë³„ ì œí•œ ì²´í¬
```

#### Week 2: ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ
```powershell
# 1. ì´ˆëŒ€ ì½”ë“œ ìƒì„± ê¸°ëŠ¥
# ReferralCode ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„

# 2. ì´ˆëŒ€ ë§í¬ ì²˜ë¦¬
# íšŒì›ê°€ì… ì‹œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ë¡œì§

# 3. ë³´ìƒ ì§€ê¸‰ ì‹œìŠ¤í…œ
# ìë™ ì—°ì¥ ë° í•œë„ ê´€ë¦¬
```

#### Week 3: ì¿ í° ì‹œìŠ¤í…œ
```powershell
# 1. ì¿ í° ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„
# Coupon, CouponUsage ëª¨ë¸ ìƒì„±

# 2. ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
# AdminCouponManager ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

# 3. ì¿ í° ì ìš© ë¡œì§
# ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì´ˆëŒ€ ì½”ë“œ í…Œì´ë¸”
CREATE TABLE referral_codes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    code VARCHAR(8) UNIQUE NOT NULL,
    invite_url VARCHAR(255) NOT NULL,
    max_uses INT DEFAULT 50,
    current_uses INT DEFAULT 0,
    expires_at DATETIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì´ˆëŒ€ ë³´ìƒ í…Œì´ë¸”
CREATE TABLE referral_rewards (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    inviter_id BIGINT NOT NULL,
    invitee_id BIGINT NOT NULL,
    referral_code VARCHAR(8) NOT NULL,
    reward_days INT DEFAULT 7,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_at TIMESTAMP,
    is_claimed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (inviter_id) REFERENCES users(id),
    FOREIGN KEY (invitee_id) REFERENCES users(id)
);

-- ì¿ í° í…Œì´ë¸”
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(12) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    coupon_type ENUM('subscription_discount', 'commission_discount', 'free_trial_extension', 'premium_upgrade', 'lifetime_discount') NOT NULL,
    discount_type ENUM('percentage', 'fixed_amount', 'free_period') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2) DEFAULT 0,
    max_discount_amount DECIMAL(10,2),
    usage_limit INT,
    used_count INT DEFAULT 0,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    target_membership JSON,
    target_users JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ì¿ í° ì‚¬ìš© ì´ë ¥ í…Œì´ë¸”
CREATE TABLE coupon_usage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    original_amount DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) NOT NULL,
    final_amount DECIMAL(10,2) NOT NULL,
    used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì‚¬ìš©ì í…Œì´ë¸” ìˆ˜ì • (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
ALTER TABLE users ADD COLUMN free_trial_end_date DATETIME;
ALTER TABLE users ADD COLUMN daily_trade_count INT DEFAULT 0;
ALTER TABLE users ADD COLUMN daily_trade_reset_date DATE;
ALTER TABLE users ADD COLUMN total_extension_days INT DEFAULT 0;
ALTER TABLE users ADD COLUMN personal_referral_code VARCHAR(8) UNIQUE;
```

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### ê±°ë˜ ì œí•œ ê²€ì¦ ì„œë¹„ìŠ¤
```python
# services/TradingLimitService.py
class TradingLimitService:
    """ê±°ë˜ ì œí•œ ê´€ë¦¬ ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def can_make_trade(user_id, trade_type='demo'):
        """ê±°ë˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸"""
        user = User.get_by_id(user_id)
        
        # ë¹„íšŒì›ì€ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
        if not user or not user.is_authenticated:
            return {
                'allowed': False,
                'reason': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                'redirect_to': '/login'
            }
        
        # ë¼ì´í”„íƒ€ì„/í”„ë¦¬ë¯¸ì—„ íšŒì›ì€ ë¬´ì œí•œ
        if user.membership_type in ['lifetime', 'premium']:
            return {'allowed': True}
        
        # ë¬´ë£Œ íšŒì› ì œí•œ ë¡œì§
        if user.membership_type == 'free':
            # ì‹ ê·œ ê°€ì… 7ì¼ ë¬´ë£Œ ê¸°ê°„ í™•ì¸
            if user.is_in_free_trial():
                return {'allowed': True}
            
            # ì¼ì¼ ê±°ë˜ ì œí•œ í™•ì¸ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
            today_trades = user.get_today_trade_count()
            if today_trades >= 2:
                return {
                    'allowed': False,
                    'reason': 'ì¼ì¼ ê±°ë˜ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (2íšŒ/ì¼)',
                    'upgrade_suggested': True
                }
            
            # ì‹¤ì „ ê±°ë˜ëŠ” ì°¨ë‹¨
            if trade_type == 'real':
                return {
                    'allowed': False,
                    'reason': 'ì‹¤ì „ ê±°ë˜ëŠ” ìœ ë£Œ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    'upgrade_required': True
                }
        
        return {'allowed': True}
    
    @staticmethod
    def record_trade(user_id, trade_type):
        """ê±°ë˜ ê¸°ë¡"""
        user = User.get_by_id(user_id)
        
        if user.membership_type == 'free':
            # ì¼ì¼ ê±°ë˜ íšŸìˆ˜ ì¦ê°€
            from datetime import date
            today = date.today()
            
            if user.daily_trade_reset_date != today:
                user.daily_trade_count = 0
                user.daily_trade_reset_date = today
            
            user.daily_trade_count += 1
            user.save()
```

## ğŸ“± UI/UX ê°œì„ ì‚¬í•­

### íšŒì›ê°€ì… í”Œë¡œìš° ê°œì„ 
```javascript
// SignupFlow.jsx
function SignupFlow() {
  const [referralCode, setReferralCode] = useState('')
  const [step, setStep] = useState(1)
  
  useEffect(() => {
    // URLì—ì„œ ì´ˆëŒ€ ì½”ë“œ ì¶”ì¶œ
    const urlParams = new URLSearchParams(window.location.search)
    const refCode = urlParams.get('ref')
    if (refCode) {
      setReferralCode(refCode)
      // ì´ˆëŒ€ ì½”ë“œ ìœ íš¨ì„± ê²€ì¦
      validateReferralCode(refCode)
    }
  }, [])
  
  const handleSignup = async (userData) => {
    const signupData = {
      ...userData,
      referral_code: referralCode
    }
    
    const response = await signup(signupData)
    if (response.success) {
      // ì‹ ê·œ ê°€ì… í˜œíƒ ì•ˆë‚´
      showWelcomeDialog({
        freeTrialDays: 7,
        hasReferral: !!referralCode
      })
    }
  }
  
  return (
    <Box>
      {referralCode && (
        <Alert severity="success" sx={{ mb: 2 }}>
          ğŸ ì¹œêµ¬ ì´ˆëŒ€ë¡œ ê°€ì…í•˜ì‹œëŠ”êµ°ìš”! 7ì¼ ë¬´ë£Œ ì²´í—˜ + ì¶”ê°€ í˜œíƒì„ ë“œë¦½ë‹ˆë‹¤.
        </Alert>
      )}
      {/* ê°€ì… í¼ */}
    </Box>
  )
}
```

ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ëŸ¬í•œ ì‹œìŠ¤í…œë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

<function_calls>
<invoke name="run_terminal_cmd">
<parameter name="command">cd ..
</code_block_to_apply_changes_from>
</edit_instructions>


Assistant:<rewritten_file>
```
# Christmas í”„ë¡œì íŠ¸ - íšŒì› ë“±ê¸‰ ë° ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ì í™•ë³´ì™€ ìˆ˜ìµí™” ìµœì í™”ë¥¼ ìœ„í•œ íšŒì› ë“±ê¸‰ ì²´ê³„, ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ, ì¿ í° ì‹œìŠ¤í…œì„ ì„¤ê³„í•©ë‹ˆë‹¤.

## ğŸ‘¥ íšŒì› ë“±ê¸‰ ì²´ê³„ (ìˆ˜ì •)

### ğŸš« ë¹„íšŒì› (Guest)
```yaml
ì ‘ê·¼_ê¶Œí•œ:
  - ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
  - ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - íšŒì›ê°€ì… ì•ˆë‚´ í˜ì´ì§€

ì œí•œ_ì‚¬í•­:
  - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
  - ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€
  - ë°ëª¨ ëª¨ë“œë„ ì œê³µí•˜ì§€ ì•ŠìŒ
```

### ğŸ†“ ë¬´ë£Œ íšŒì› (Free Member)
```yaml
ê¸°ë³¸_í˜œíƒ:
  - ë§¤ì¼ ëª¨ì˜ íˆ¬ì ë§¤ë§¤ 2íšŒ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
  - ê¸°ë³¸ ì°¨íŠ¸ ì¡°íšŒ (ì œí•œì )
  - íˆ¬ì êµìœ¡ ì½˜í…ì¸  (ê¸°ì´ˆ ê³¼ì •ë§Œ)

ì‹ ê·œ_ê°€ì…_í˜œíƒ:
  - ìµœì´ˆ ê°€ì… í›„ 7ì¼ê°„ ë¬´ì œí•œ ëª¨ì˜ ë§¤ë§¤
  - 7ì¼ í›„ ì¼ì¼ 2íšŒ ì œí•œìœ¼ë¡œ ë³€ê²½
  - ìœ ë£Œ íšŒì› ì „í™˜ ì•ˆë‚´

ì œí•œ_ì‚¬í•­:
  - ì‹¤ì „ ê±°ë˜ ì™„ì „ ì°¨ë‹¨
  - API ì—°ë™ ë¶ˆê°€
  - ê³ ê¸‰ ë¶„ì„ ë„êµ¬ ì œí•œ
  - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì œí•œ
  - ë°±í…ŒìŠ¤íŒ… ë¶ˆê°€
```

### ğŸ’ í”„ë¦¬ë¯¸ì—„ íšŒì› (Premium Member)
```yaml
ì›”_êµ¬ë…_í˜œíƒ:
  - ìš”ê¸ˆ: $15/ì›”
  - ì‹¤ì „ ê±°ë˜ ë¬´ì œí•œ
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ: 1%
  - ëª¨ë“  ì°¨íŠ¸ ë° ì§€í‘œ ì´ìš©
  - ì‹¤ì‹œê°„ ì•Œë¦¼ (í…”ë ˆê·¸ë¨, ì´ë©”ì¼)
  - ë°±í…ŒìŠ¤íŒ… ê¸°ëŠ¥
  - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë¶„ì„
  - ìš°ì„  ê³ ê° ì§€ì›

ì¶”ê°€_ê¸°ëŠ¥:
  - API í‚¤ ê°œì¸ ì„¤ì •
  - ê³ ê¸‰ ë§¤ë§¤ ì „ëµ ì´ìš©
  - ì»¤ë®¤ë‹ˆí‹° ì „ì²´ ì ‘ê·¼
  - ì›”ê°„ íˆ¬ì ë¦¬í¬íŠ¸
```

### ğŸ† ë¼ì´í”„íƒ€ì„ íšŒì› (Lifetime Member)
```yaml
ì¼ì‹œë¶ˆ_í˜œíƒ:
  - ìš”ê¸ˆ: â‚©10,000,000 (í™˜ë¶ˆ ë¶ˆê°€)
  - ëª¨ë“  í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ ì™„ì „ ë©´ì œ
  - VIP ì „ìš© ê¸°ëŠ¥
  - ê°œì¸ ë§ì¶¤ ì „ëµ ì»¨ì„¤íŒ…
  - ë² íƒ€ ê¸°ëŠ¥ ìš°ì„  ì²´í—˜
  - ì „ìš© ê³ ê° ì§€ì› ì±„ë„
  - í‰ìƒ ì„œë¹„ìŠ¤ ë³´ì¥

íŠ¹ë³„_í˜œíƒ:
  - ì‹ ê·œ ê¸°ëŠ¥ ë¬´ë£Œ ì—…ê·¸ë ˆì´ë“œ
  - ì›”ê°„ ê°œì¸ íˆ¬ì ìƒë‹´
  - VIP ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼
  - ì—°ê°„ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜ ì°¸ì„ê¶Œ
```

## ğŸ ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ

### ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹œìŠ¤í…œ
```python
# models/ReferralCode.py
class ReferralCode:
    """ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ ëª¨ë¸"""
    
    def __init__(self):
        self.user_id = None          # ì´ˆëŒ€ì ID
        self.code = None             # 8ìë¦¬ ê³ ìœ  ì½”ë“œ
        self.invite_url = None       # ì´ˆëŒ€ ë§í¬ URL
        self.created_at = None       # ìƒì„± ì¼ì‹œ
        self.expires_at = None       # ë§Œë£Œ ì¼ì‹œ (90ì¼ í›„)
        self.max_uses = 50           # ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜
        self.current_uses = 0        # í˜„ì¬ ì‚¬ìš© íšŸìˆ˜
        self.is_active = True        # í™œì„± ìƒíƒœ
        
    def generate_code(self, user_id):
        """ê³ ìœ  ì´ˆëŒ€ ì½”ë“œ ìƒì„±"""
        import random
        import string
        from datetime import datetime, timedelta
        
        # 8ìë¦¬ ì˜ìˆ«ì ì¡°í•© ì½”ë“œ ìƒì„±
        self.code = ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=8
        ))
        
        self.user_id = user_id
        self.invite_url = f"https://christmas-trading.com/signup?ref={self.code}"
        self.created_at = datetime.now()
        self.expires_at = datetime.now() + timedelta(days=90)
        
        return self.code
    
    def is_valid(self):
        """ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬"""
        from datetime import datetime
        
        return (
            self.is_active and 
            self.current_uses < self.max_uses and
            datetime.now() < self.expires_at
        )

# models/ReferralReward.py
class ReferralReward:
    """ì´ˆëŒ€ ë³´ìƒ ëª¨ë¸"""
    
    def __init__(self):
        self.inviter_id = None       # ì´ˆëŒ€ì ID
        self.invitee_id = None       # í”¼ì´ˆëŒ€ì ID
        self.referral_code = None    # ì‚¬ìš©ëœ ì´ˆëŒ€ ì½”ë“œ
        self.reward_type = 'free_extension'  # ë³´ìƒ ìœ í˜•
        self.reward_days = 7         # ë³´ìƒ ì¼ìˆ˜
        self.created_at = None       # ë³´ìƒ ìƒì„± ì¼ì‹œ
        self.applied_at = None       # ë³´ìƒ ì ìš© ì¼ì‹œ
        self.is_claimed = False      # ë³´ìƒ ìˆ˜ë ¹ ì—¬ë¶€
        
    def apply_reward(self, inviter_id, invitee_id, code):
        """ì´ˆëŒ€ ë³´ìƒ ì ìš©"""
        from datetime import datetime
        
        self.inviter_id = inviter_id
        self.invitee_id = invitee_id
        self.referral_code = code
        self.created_at = datetime.now()
        
        # ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ë¶€ì—¬
        self.extend_membership(inviter_id, 7)
        self.is_claimed = True
        self.applied_at = datetime.now()
        
    def extend_membership(self, user_id, days):
        """íšŒì›ê¶Œ ì—°ì¥"""
        user = User.get_by_id(user_id)
        current_total_extension = self.get_total_extension_days(user_id)
        
        # ìµœëŒ€ 3ê°œì›”(90ì¼) ì œí•œ í™•ì¸
        if current_total_extension + days <= 90:
            user.extend_free_period(days)
            return True
        else:
            # 90ì¼ í•œë„ ì´ˆê³¼ì‹œ ë‚¨ì€ ì¼ìˆ˜ë§Œ ì—°ì¥
            remaining_days = 90 - current_total_extension
            if remaining_days > 0:
                user.extend_free_period(remaining_days)
            return False
```

### ì´ˆëŒ€ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°
```yaml
ì´ˆëŒ€_í”„ë¡œì„¸ìŠ¤:
  1. ì´ˆëŒ€ìê°€ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
  2. ì´ˆëŒ€ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ 
  3. ì¹œêµ¬ê°€ ë§í¬ë¥¼ í†µí•´ íšŒì›ê°€ì…
  4. ì‹œìŠ¤í…œì´ ì´ˆëŒ€ ê´€ê³„ í™•ì¸
  5. ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ìë™ ì§€ê¸‰
  6. í”¼ì´ˆëŒ€ìëŠ” ì‹ ê·œ ê°€ì… í˜œíƒ (7ì¼ ë¬´ë£Œ) ì œê³µ

ì œí•œ_ì‚¬í•­:
  - ì´ˆëŒ€ìë‹¹ ìµœëŒ€ ì—°ì¥ ê¸°ê°„: 3ê°œì›” (90ì¼)
  - ì½”ë“œ ìœ íš¨ ê¸°ê°„: 90ì¼
  - ì½”ë“œë‹¹ ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜: 50íšŒ
  - ìê°€ ì´ˆëŒ€ ë°©ì§€ ë¡œì§ êµ¬í˜„
```

## ğŸ« ì¿ í° ì‹œìŠ¤í…œ

### ì¿ í° ìœ í˜• ì„¤ê³„
```python
# models/Coupon.py
class Coupon:
    """ì¿ í° ì‹œìŠ¤í…œ ëª¨ë¸"""
    
    def __init__(self):
        self.coupon_id = None        # ì¿ í° ê³ ìœ  ID
        self.code = None             # ì¿ í° ì½”ë“œ
        self.name = None             # ì¿ í° ì´ë¦„
        self.description = None      # ì¿ í° ì„¤ëª…
        self.coupon_type = None      # ì¿ í° ìœ í˜•
        self.discount_type = None    # í• ì¸ ìœ í˜•
        self.discount_value = None   # í• ì¸ ê°’
        self.min_purchase_amount = 0 # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
        self.max_discount_amount = None # ìµœëŒ€ í• ì¸ ê¸ˆì•¡
        self.usage_limit = None      # ì‚¬ìš© íšŸìˆ˜ ì œí•œ
        self.used_count = 0          # ì‚¬ìš©ëœ íšŸìˆ˜
        self.start_date = None       # ì‹œì‘ ì¼ì‹œ
        self.end_date = None         # ì¢…ë£Œ ì¼ì‹œ
        self.target_users = []       # ëŒ€ìƒ ì‚¬ìš©ì (ë¹ˆ ë°°ì—´ì‹œ ì „ì²´)
        self.target_membership = []  # ëŒ€ìƒ íšŒì› ë“±ê¸‰
        self.is_active = True        # í™œì„± ìƒíƒœ
        self.created_by = None       # ìƒì„±ì (ê´€ë¦¬ì ID)
        self.created_at = None       # ìƒì„± ì¼ì‹œ

# ì¿ í° ìœ í˜• ì •ì˜
COUPON_TYPES = {
    'subscription_discount': 'êµ¬ë…ë£Œ í• ì¸',
    'commission_discount': 'ìˆ˜ìˆ˜ë£Œ í• ì¸', 
    'free_trial_extension': 'ë¬´ë£Œ ì²´í—˜ ì—°ì¥',
    'premium_upgrade': 'í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ',
    'lifetime_discount': 'ë¼ì´í”„íƒ€ì„ í• ì¸'
}

DISCOUNT_TYPES = {
    'percentage': 'í¼ì„¼íŠ¸ í• ì¸',
    'fixed_amount': 'ê³ ì • ê¸ˆì•¡ í• ì¸',
    'free_period': 'ë¬´ë£Œ ê¸°ê°„ ì œê³µ'
}

class CouponService:
    """ì¿ í° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤"""
    
    @staticmethod
    def create_coupon(admin_id, coupon_data):
        """ê´€ë¦¬ì ì¿ í° ìƒì„±"""
        import random
        import string
        from datetime import datetime
        
        coupon = Coupon()
        coupon.code = CouponService.generate_coupon_code()
        coupon.name = coupon_data['name']
        coupon.description = coupon_data['description']
        coupon.coupon_type = coupon_data['coupon_type']
        coupon.discount_type = coupon_data['discount_type']
        coupon.discount_value = coupon_data['discount_value']
        coupon.min_purchase_amount = coupon_data.get('min_purchase_amount', 0)
        coupon.max_discount_amount = coupon_data.get('max_discount_amount')
        coupon.usage_limit = coupon_data.get('usage_limit')
        coupon.start_date = coupon_data['start_date']
        coupon.end_date = coupon_data['end_date']
        coupon.target_users = coupon_data.get('target_users', [])
        coupon.target_membership = coupon_data.get('target_membership', [])
        coupon.created_by = admin_id
        coupon.created_at = datetime.now()
        
        return coupon.save()
    
    @staticmethod
    def generate_coupon_code():
        """ì¿ í° ì½”ë“œ ìƒì„± (12ìë¦¬)"""
        return ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=12
        ))
    
    @staticmethod
    def validate_coupon(code, user_id, purchase_amount=0):
        """ì¿ í° ìœ íš¨ì„± ê²€ì¦"""
        from datetime import datetime
        
        coupon = Coupon.get_by_code(code)
        if not coupon:
            return {'valid': False, 'reason': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # í™œì„± ìƒíƒœ í™•ì¸
        if not coupon.is_active:
            return {'valid': False, 'reason': 'ë¹„í™œì„±í™”ëœ ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # ê¸°ê°„ í™•ì¸
        now = datetime.now()
        if now < coupon.start_date or now > coupon.end_date:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ì‚¬ìš© íšŸìˆ˜ í™•ì¸
        if coupon.usage_limit and coupon.used_count >= coupon.usage_limit:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.'}
        
        # ëŒ€ìƒ ì‚¬ìš©ì í™•ì¸
        if coupon.target_users and user_id not in coupon.target_users:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ í™•ì¸
        if purchase_amount < coupon.min_purchase_amount:
            return {'valid': False, 'reason': f'ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ {coupon.min_purchase_amount:,}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'}
        
        # íšŒì› ë“±ê¸‰ í™•ì¸
        user = User.get_by_id(user_id)
        if coupon.target_membership and user.membership_type not in coupon.target_membership:
            return {'valid': False, 'reason': 'í•´ë‹¹ íšŒì› ë“±ê¸‰ì€ ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {'valid': True, 'coupon': coupon}
    
    @staticmethod
    def apply_coupon(coupon, user_id, purchase_amount):
        """ì¿ í° ì ìš©"""
        discount_amount = 0
        
        if coupon.discount_type == 'percentage':
            discount_amount = purchase_amount * (coupon.discount_value / 100)
            if coupon.max_discount_amount:
                discount_amount = min(discount_amount, coupon.max_discount_amount)
                
        elif coupon.discount_type == 'fixed_amount':
            discount_amount = coupon.discount_value
            
        elif coupon.discount_type == 'free_period':
            # ë¬´ë£Œ ê¸°ê°„ ì œê³µ ë¡œì§
            user = User.get_by_id(user_id)
            user.extend_free_period(coupon.discount_value)
            discount_amount = purchase_amount  # ì „ì•¡ í• ì¸
        
        # ì¿ í° ì‚¬ìš© ê¸°ë¡
        coupon.used_count += 1
        coupon.save()
        
        # ì‚¬ìš© ì´ë ¥ ì €ì¥
        CouponUsage.create({
            'coupon_id': coupon.coupon_id,
            'user_id': user_id,
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount,
            'used_at': datetime.now()
        })
        
        return {
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount
        }
```

### ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
```javascript
// AdminCouponManager.jsx
import React, { useState, useEffect } from 'react'
import {
  Box, Card, CardContent, Typography, Button, Dialog,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Chip, Grid, Alert, IconButton
} from '@mui/material'
import {
  Add, Edit, Delete, Visibility, GetApp
} from '@mui/icons-material'

function AdminCouponManager() {
  const [coupons, setCoupons] = useState([])
  const [createDialog, setCreateDialog] = useState(false)
  const [newCoupon, setNewCoupon] = useState({
    name: '',
    description: '',
    coupon_type: 'subscription_discount',
    discount_type: 'percentage',
    discount_value: '',
    min_purchase_amount: 0,
    max_discount_amount: '',
    usage_limit: '',
    start_date: '',
    end_date: '',
    target_membership: []
  })

  const handleCreateCoupon = async () => {
    try {
      const response = await fetch('/api/admin/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newCoupon)
      })
      
      if (response.ok) {
        const createdCoupon = await response.json()
        setCoupons([...coupons, createdCoupon])
        setCreateDialog(false)
        setNewCoupon({})
      }
    } catch (error) {
      console.error('ì¿ í° ìƒì„± ì‹¤íŒ¨:', error)
    }
  }

  const getCouponStatusColor = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'error'
    if (now < startDate) return 'warning'
    if (now > endDate) return 'default'
    return 'success'
  }

  const getCouponStatusText = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'ë¹„í™œì„±'
    if (now < startDate) return 'ëŒ€ê¸°ì¤‘'
    if (now > endDate) return 'ë§Œë£Œë¨'
    return 'í™œì„±'
  }

  return (
    <Box>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h5">ğŸ« ì¿ í° ê´€ë¦¬</Typography>
        <Button
          variant="contained"
          startIcon={<Add />}
          onClick={() => setCreateDialog(true)}
        >
          ì¿ í° ìƒì„±
        </Button>
      </Box>

      {/* ì¿ í° í†µê³„ */}
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="primary">
                {coupons.filter(c => c.is_active).length}
              </Typography>
              <Typography variant="body2">í™œì„± ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="success.main">
                {coupons.reduce((sum, c) => sum + c.used_count, 0)}
              </Typography>
              <Typography variant="body2">ì´ ì‚¬ìš© íšŸìˆ˜</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="warning.main">
                {coupons.filter(c => new Date() < new Date(c.start_date)).length}
              </Typography>
              <Typography variant="body2">ì˜ˆì•½ëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="error.main">
                {coupons.filter(c => new Date() > new Date(c.end_date)).length}
              </Typography>
              <Typography variant="body2">ë§Œë£Œëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* ì¿ í° ëª©ë¡ */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>ì¿ í°ëª…</TableCell>
                  <TableCell>ì½”ë“œ</TableCell>
                  <TableCell>ìœ í˜•</TableCell>
                  <TableCell>í• ì¸ê°’</TableCell>
                  <TableCell>ì‚¬ìš©íšŸìˆ˜</TableCell>
                  <TableCell>ê¸°ê°„</TableCell>
                  <TableCell>ìƒíƒœ</TableCell>
                  <TableCell>ê´€ë¦¬</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {coupons.map((coupon) => (
                  <TableRow key={coupon.coupon_id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {coupon.name}
                      </Typography>
                      <Typography variant="caption" color="textSecondary">
                        {coupon.description}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontFamily="monospace">
                        {coupon.code}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {coupon.coupon_type}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {coupon.discount_type === 'percentage' 
                        ? `${coupon.discount_value}%`
                        : `${coupon.discount_value:,}ì›`}
                    </TableCell>
                    <TableCell>
                      {coupon.used_count} / {coupon.usage_limit || 'ë¬´ì œí•œ'}
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {new Date(coupon.start_date).toLocaleDateString()} ~<br/>
                        {new Date(coupon.end_date).toLocaleDateString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip 
                        label={getCouponStatusText(coupon)}
                        color={getCouponStatusColor(coupon)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <IconButton size="small">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" color="error">
                        <Delete />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* ì¿ í° ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog 
        open={createDialog} 
        onClose={() => setCreateDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {/* ì¿ í° ìƒì„± í¼ êµ¬í˜„ */}
      </Dialog>
    </Box>
  )
}

export default AdminCouponManager
```

## ğŸ”„ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2A-Extended: íšŒì› ì‹œìŠ¤í…œ ê³ ë„í™” (D+1 ~ D+21)

#### Week 1: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ ìˆ˜ì •
```powershell
# 1. íšŒì› ëª¨ë¸ ì—…ë°ì´íŠ¸
# User ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
- free_trial_end_date    # ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼
- daily_trade_count      # ì¼ì¼ ê±°ë˜ íšŸìˆ˜
- total_extension_days   # ì´ ì—°ì¥ ì¼ìˆ˜
- referral_code          # ê°œì¸ ì´ˆëŒ€ ì½”ë“œ

# 2. ê±°ë˜ ì œí•œ ë¡œì§ êµ¬í˜„
# TradeControllerì—ì„œ íšŒì› ë“±ê¸‰ë³„ ì œí•œ ì²´í¬
```

#### Week 2: ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ
```powershell
# 1. ì´ˆëŒ€ ì½”ë“œ ìƒì„± ê¸°ëŠ¥
# ReferralCode ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„

# 2. ì´ˆëŒ€ ë§í¬ ì²˜ë¦¬
# íšŒì›ê°€ì… ì‹œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ë¡œì§

# 3. ë³´ìƒ ì§€ê¸‰ ì‹œìŠ¤í…œ
# ìë™ ì—°ì¥ ë° í•œë„ ê´€ë¦¬
```

#### Week 3: ì¿ í° ì‹œìŠ¤í…œ
```powershell
# 1. ì¿ í° ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„
# Coupon, CouponUsage ëª¨ë¸ ìƒì„±

# 2. ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
# AdminCouponManager ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

# 3. ì¿ í° ì ìš© ë¡œì§
# ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì´ˆëŒ€ ì½”ë“œ í…Œì´ë¸”
CREATE TABLE referral_codes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    code VARCHAR(8) UNIQUE NOT NULL,
    invite_url VARCHAR(255) NOT NULL,
    max_uses INT DEFAULT 50,
    current_uses INT DEFAULT 0,
    expires_at DATETIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì´ˆëŒ€ ë³´ìƒ í…Œì´ë¸”
CREATE TABLE referral_rewards (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    inviter_id BIGINT NOT NULL,
    invitee_id BIGINT NOT NULL,
    referral_code VARCHAR(8) NOT NULL,
    reward_days INT DEFAULT 7,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_at TIMESTAMP,
    is_claimed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (inviter_id) REFERENCES users(id),
    FOREIGN KEY (invitee_id) REFERENCES users(id)
);

-- ì¿ í° í…Œì´ë¸”
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(12) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    coupon_type ENUM('subscription_discount', 'commission_discount', 'free_trial_extension', 'premium_upgrade', 'lifetime_discount') NOT NULL,
    discount_type ENUM('percentage', 'fixed_amount', 'free_period') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2) DEFAULT 0,
    max_discount_amount DECIMAL(10,2),
    usage_limit INT,
    used_count INT DEFAULT 0,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    target_membership JSON,
    target_users JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ì¿ í° ì‚¬ìš© ì´ë ¥ í…Œì´ë¸”
CREATE TABLE coupon_usage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    original_amount DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) NOT NULL,
    final_amount DECIMAL(10,2) NOT NULL,
    used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì‚¬ìš©ì í…Œì´ë¸” ìˆ˜ì • (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
ALTER TABLE users ADD COLUMN free_trial_end_date DATETIME;
ALTER TABLE users ADD COLUMN daily_trade_count INT DEFAULT 0;
ALTER TABLE users ADD COLUMN daily_trade_reset_date DATE;
ALTER TABLE users ADD COLUMN total_extension_days INT DEFAULT 0;
ALTER TABLE users ADD COLUMN personal_referral_code VARCHAR(8) UNIQUE;
```

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### ê±°ë˜ ì œí•œ ê²€ì¦ ì„œë¹„ìŠ¤
```python
# services/TradingLimitService.py
class TradingLimitService:
    """ê±°ë˜ ì œí•œ ê´€ë¦¬ ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def can_make_trade(user_id, trade_type='demo'):
        """ê±°ë˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸"""
        user = User.get_by_id(user_id)
        
        # ë¹„íšŒì›ì€ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
        if not user or not user.is_authenticated:
            return {
                'allowed': False,
                'reason': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                'redirect_to': '/login'
            }
        
        # ë¼ì´í”„íƒ€ì„/í”„ë¦¬ë¯¸ì—„ íšŒì›ì€ ë¬´ì œí•œ
        if user.membership_type in ['lifetime', 'premium']:
            return {'allowed': True}
        
        # ë¬´ë£Œ íšŒì› ì œí•œ ë¡œì§
        if user.membership_type == 'free':
            # ì‹ ê·œ ê°€ì… 7ì¼ ë¬´ë£Œ ê¸°ê°„ í™•ì¸
            if user.is_in_free_trial():
                return {'allowed': True}
            
            # ì¼ì¼ ê±°ë˜ ì œí•œ í™•ì¸ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
            today_trades = user.get_today_trade_count()
            if today_trades >= 2:
                return {
                    'allowed': False,
                    'reason': 'ì¼ì¼ ê±°ë˜ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (2íšŒ/ì¼)',
                    'upgrade_suggested': True
                }
            
            # ì‹¤ì „ ê±°ë˜ëŠ” ì°¨ë‹¨
            if trade_type == 'real':
                return {
                    'allowed': False,
                    'reason': 'ì‹¤ì „ ê±°ë˜ëŠ” ìœ ë£Œ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    'upgrade_required': True
                }
        
        return {'allowed': True}
    
    @staticmethod
    def record_trade(user_id, trade_type):
        """ê±°ë˜ ê¸°ë¡"""
        user = User.get_by_id(user_id)
        
        if user.membership_type == 'free':
            # ì¼ì¼ ê±°ë˜ íšŸìˆ˜ ì¦ê°€
            from datetime import date
            today = date.today()
            
            if user.daily_trade_reset_date != today:
                user.daily_trade_count = 0
                user.daily_trade_reset_date = today
            
            user.daily_trade_count += 1
            user.save()
```

## ğŸ“± UI/UX ê°œì„ ì‚¬í•­

### íšŒì›ê°€ì… í”Œë¡œìš° ê°œì„ 
```javascript
// SignupFlow.jsx
function SignupFlow() {
  const [referralCode, setReferralCode] = useState('')
  const [step, setStep] = useState(1)
  
  useEffect(() => {
    // URLì—ì„œ ì´ˆëŒ€ ì½”ë“œ ì¶”ì¶œ
    const urlParams = new URLSearchParams(window.location.search)
    const refCode = urlParams.get('ref')
    if (refCode) {
      setReferralCode(refCode)
      // ì´ˆëŒ€ ì½”ë“œ ìœ íš¨ì„± ê²€ì¦
      validateReferralCode(refCode)
    }
  }, [])
  
  const handleSignup = async (userData) => {
    const signupData = {
      ...userData,
      referral_code: referralCode
    }
    
    const response = await signup(signupData)
    if (response.success) {
      // ì‹ ê·œ ê°€ì… í˜œíƒ ì•ˆë‚´
      showWelcomeDialog({
        freeTrialDays: 7,
        hasReferral: !!referralCode
      })
    }
  }
  
  return (
    <Box>
      {referralCode && (
        <Alert severity="success" sx={{ mb: 2 }}>
          ğŸ ì¹œêµ¬ ì´ˆëŒ€ë¡œ ê°€ì…í•˜ì‹œëŠ”êµ°ìš”! 7ì¼ ë¬´ë£Œ ì²´í—˜ + ì¶”ê°€ í˜œíƒì„ ë“œë¦½ë‹ˆë‹¤.
        </Alert>
      )}
      {/* ê°€ì… í¼ */}
    </Box>
  )
}
```

ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ëŸ¬í•œ ì‹œìŠ¤í…œë“¤ì„ ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ë¶€í„° ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤.

<function_calls>
<invoke name="run_terminal_cmd">
<parameter name="command">cd ..
</code_block_to_apply_changes_from>
</edit_instructions>


Assistant:<rewritten_file>
```
# Christmas í”„ë¡œì íŠ¸ - íšŒì› ë“±ê¸‰ ë° ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ì„¤ê³„

## ğŸ“‹ ê°œìš”

ì‚¬ìš©ì í™•ë³´ì™€ ìˆ˜ìµí™” ìµœì í™”ë¥¼ ìœ„í•œ íšŒì› ë“±ê¸‰ ì²´ê³„, ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ, ì¿ í° ì‹œìŠ¤í…œì„ ì„¤ê³„í•©ë‹ˆë‹¤.

## ğŸ‘¥ íšŒì› ë“±ê¸‰ ì²´ê³„ (ìˆ˜ì •)

### ğŸš« ë¹„íšŒì› (Guest)
```yaml
ì ‘ê·¼_ê¶Œí•œ:
  - ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€
  - ë¡œê·¸ì¸ í˜ì´ì§€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  - íšŒì›ê°€ì… ì•ˆë‚´ í˜ì´ì§€

ì œí•œ_ì‚¬í•­:
  - ëª¨ë“  ê¸°ëŠ¥ ì°¨ë‹¨
  - ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€
  - ë°ëª¨ ëª¨ë“œë„ ì œê³µí•˜ì§€ ì•ŠìŒ
```

### ğŸ†“ ë¬´ë£Œ íšŒì› (Free Member)
```yaml
ê¸°ë³¸_í˜œíƒ:
  - ë§¤ì¼ ëª¨ì˜ íˆ¬ì ë§¤ë§¤ 2íšŒ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
  - ê¸°ë³¸ ì°¨íŠ¸ ì¡°íšŒ (ì œí•œì )
  - íˆ¬ì êµìœ¡ ì½˜í…ì¸  (ê¸°ì´ˆ ê³¼ì •ë§Œ)

ì‹ ê·œ_ê°€ì…_í˜œíƒ:
  - ìµœì´ˆ ê°€ì… í›„ 7ì¼ê°„ ë¬´ì œí•œ ëª¨ì˜ ë§¤ë§¤
  - 7ì¼ í›„ ì¼ì¼ 2íšŒ ì œí•œìœ¼ë¡œ ë³€ê²½
  - ìœ ë£Œ íšŒì› ì „í™˜ ì•ˆë‚´

ì œí•œ_ì‚¬í•­:
  - ì‹¤ì „ ê±°ë˜ ì™„ì „ ì°¨ë‹¨
  - API ì—°ë™ ë¶ˆê°€
  - ê³ ê¸‰ ë¶„ì„ ë„êµ¬ ì œí•œ
  - í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì œí•œ
  - ë°±í…ŒìŠ¤íŒ… ë¶ˆê°€
```

### ğŸ’ í”„ë¦¬ë¯¸ì—„ íšŒì› (Premium Member)
```yaml
ì›”_êµ¬ë…_í˜œíƒ:
  - ìš”ê¸ˆ: $15/ì›”
  - ì‹¤ì „ ê±°ë˜ ë¬´ì œí•œ
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ: 1%
  - ëª¨ë“  ì°¨íŠ¸ ë° ì§€í‘œ ì´ìš©
  - ì‹¤ì‹œê°„ ì•Œë¦¼ (í…”ë ˆê·¸ë¨, ì´ë©”ì¼)
  - ë°±í…ŒìŠ¤íŒ… ê¸°ëŠ¥
  - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„¸ ë¶„ì„
  - ìš°ì„  ê³ ê° ì§€ì›

ì¶”ê°€_ê¸°ëŠ¥:
  - API í‚¤ ê°œì¸ ì„¤ì •
  - ê³ ê¸‰ ë§¤ë§¤ ì „ëµ ì´ìš©
  - ì»¤ë®¤ë‹ˆí‹° ì „ì²´ ì ‘ê·¼
  - ì›”ê°„ íˆ¬ì ë¦¬í¬íŠ¸
```

### ğŸ† ë¼ì´í”„íƒ€ì„ íšŒì› (Lifetime Member)
```yaml
ì¼ì‹œë¶ˆ_í˜œíƒ:
  - ìš”ê¸ˆ: â‚©10,000,000 (í™˜ë¶ˆ ë¶ˆê°€)
  - ëª¨ë“  í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  - ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ ì™„ì „ ë©´ì œ
  - VIP ì „ìš© ê¸°ëŠ¥
  - ê°œì¸ ë§ì¶¤ ì „ëµ ì»¨ì„¤íŒ…
  - ë² íƒ€ ê¸°ëŠ¥ ìš°ì„  ì²´í—˜
  - ì „ìš© ê³ ê° ì§€ì› ì±„ë„
  - í‰ìƒ ì„œë¹„ìŠ¤ ë³´ì¥

íŠ¹ë³„_í˜œíƒ:
  - ì‹ ê·œ ê¸°ëŠ¥ ë¬´ë£Œ ì—…ê·¸ë ˆì´ë“œ
  - ì›”ê°„ ê°œì¸ íˆ¬ì ìƒë‹´
  - VIP ì»¤ë®¤ë‹ˆí‹° ì ‘ê·¼
  - ì—°ê°„ ì˜¤í”„ë¼ì¸ ì„¸ë¯¸ë‚˜ ì°¸ì„ê¶Œ
```

## ğŸ ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ

### ì´ˆëŒ€ ì½”ë“œ ìƒì„± ì‹œìŠ¤í…œ
```python
# models/ReferralCode.py
class ReferralCode:
    """ì¹œêµ¬ ì´ˆëŒ€ ì½”ë“œ ëª¨ë¸"""
    
    def __init__(self):
        self.user_id = None          # ì´ˆëŒ€ì ID
        self.code = None             # 8ìë¦¬ ê³ ìœ  ì½”ë“œ
        self.invite_url = None       # ì´ˆëŒ€ ë§í¬ URL
        self.created_at = None       # ìƒì„± ì¼ì‹œ
        self.expires_at = None       # ë§Œë£Œ ì¼ì‹œ (90ì¼ í›„)
        self.max_uses = 50           # ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜
        self.current_uses = 0        # í˜„ì¬ ì‚¬ìš© íšŸìˆ˜
        self.is_active = True        # í™œì„± ìƒíƒœ
        
    def generate_code(self, user_id):
        """ê³ ìœ  ì´ˆëŒ€ ì½”ë“œ ìƒì„±"""
        import random
        import string
        from datetime import datetime, timedelta
        
        # 8ìë¦¬ ì˜ìˆ«ì ì¡°í•© ì½”ë“œ ìƒì„±
        self.code = ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=8
        ))
        
        self.user_id = user_id
        self.invite_url = f"https://christmas-trading.com/signup?ref={self.code}"
        self.created_at = datetime.now()
        self.expires_at = datetime.now() + timedelta(days=90)
        
        return self.code
    
    def is_valid(self):
        """ì½”ë“œ ìœ íš¨ì„± ê²€ì‚¬"""
        from datetime import datetime
        
        return (
            self.is_active and 
            self.current_uses < self.max_uses and
            datetime.now() < self.expires_at
        )

# models/ReferralReward.py
class ReferralReward:
    """ì´ˆëŒ€ ë³´ìƒ ëª¨ë¸"""
    
    def __init__(self):
        self.inviter_id = None       # ì´ˆëŒ€ì ID
        self.invitee_id = None       # í”¼ì´ˆëŒ€ì ID
        self.referral_code = None    # ì‚¬ìš©ëœ ì´ˆëŒ€ ì½”ë“œ
        self.reward_type = 'free_extension'  # ë³´ìƒ ìœ í˜•
        self.reward_days = 7         # ë³´ìƒ ì¼ìˆ˜
        self.created_at = None       # ë³´ìƒ ìƒì„± ì¼ì‹œ
        self.applied_at = None       # ë³´ìƒ ì ìš© ì¼ì‹œ
        self.is_claimed = False      # ë³´ìƒ ìˆ˜ë ¹ ì—¬ë¶€
        
    def apply_reward(self, inviter_id, invitee_id, code):
        """ì´ˆëŒ€ ë³´ìƒ ì ìš©"""
        from datetime import datetime
        
        self.inviter_id = inviter_id
        self.invitee_id = invitee_id
        self.referral_code = code
        self.created_at = datetime.now()
        
        # ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ë¶€ì—¬
        self.extend_membership(inviter_id, 7)
        self.is_claimed = True
        self.applied_at = datetime.now()
        
    def extend_membership(self, user_id, days):
        """íšŒì›ê¶Œ ì—°ì¥"""
        user = User.get_by_id(user_id)
        current_total_extension = self.get_total_extension_days(user_id)
        
        # ìµœëŒ€ 3ê°œì›”(90ì¼) ì œí•œ í™•ì¸
        if current_total_extension + days <= 90:
            user.extend_free_period(days)
            return True
        else:
            # 90ì¼ í•œë„ ì´ˆê³¼ì‹œ ë‚¨ì€ ì¼ìˆ˜ë§Œ ì—°ì¥
            remaining_days = 90 - current_total_extension
            if remaining_days > 0:
                user.extend_free_period(remaining_days)
            return False
```

### ì´ˆëŒ€ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°
```yaml
ì´ˆëŒ€_í”„ë¡œì„¸ìŠ¤:
  1. ì´ˆëŒ€ìê°€ ì´ˆëŒ€ ì½”ë“œ ìƒì„±
  2. ì´ˆëŒ€ ë§í¬ë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ 
  3. ì¹œêµ¬ê°€ ë§í¬ë¥¼ í†µí•´ íšŒì›ê°€ì…
  4. ì‹œìŠ¤í…œì´ ì´ˆëŒ€ ê´€ê³„ í™•ì¸
  5. ì´ˆëŒ€ìì—ê²Œ 7ì¼ ì—°ì¥ í˜œíƒ ìë™ ì§€ê¸‰
  6. í”¼ì´ˆëŒ€ìëŠ” ì‹ ê·œ ê°€ì… í˜œíƒ (7ì¼ ë¬´ë£Œ) ì œê³µ

ì œí•œ_ì‚¬í•­:
  - ì´ˆëŒ€ìë‹¹ ìµœëŒ€ ì—°ì¥ ê¸°ê°„: 3ê°œì›” (90ì¼)
  - ì½”ë“œ ìœ íš¨ ê¸°ê°„: 90ì¼
  - ì½”ë“œë‹¹ ìµœëŒ€ ì‚¬ìš© íšŸìˆ˜: 50íšŒ
  - ìê°€ ì´ˆëŒ€ ë°©ì§€ ë¡œì§ êµ¬í˜„
```

## ğŸ« ì¿ í° ì‹œìŠ¤í…œ

### ì¿ í° ìœ í˜• ì„¤ê³„
```python
# models/Coupon.py
class Coupon:
    """ì¿ í° ì‹œìŠ¤í…œ ëª¨ë¸"""
    
    def __init__(self):
        self.coupon_id = None        # ì¿ í° ê³ ìœ  ID
        self.code = None             # ì¿ í° ì½”ë“œ
        self.name = None             # ì¿ í° ì´ë¦„
        self.description = None      # ì¿ í° ì„¤ëª…
        self.coupon_type = None      # ì¿ í° ìœ í˜•
        self.discount_type = None    # í• ì¸ ìœ í˜•
        self.discount_value = None   # í• ì¸ ê°’
        self.min_purchase_amount = 0 # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡
        self.max_discount_amount = None # ìµœëŒ€ í• ì¸ ê¸ˆì•¡
        self.usage_limit = None      # ì‚¬ìš© íšŸìˆ˜ ì œí•œ
        self.used_count = 0          # ì‚¬ìš©ëœ íšŸìˆ˜
        self.start_date = None       # ì‹œì‘ ì¼ì‹œ
        self.end_date = None         # ì¢…ë£Œ ì¼ì‹œ
        self.target_users = []       # ëŒ€ìƒ ì‚¬ìš©ì (ë¹ˆ ë°°ì—´ì‹œ ì „ì²´)
        self.target_membership = []  # ëŒ€ìƒ íšŒì› ë“±ê¸‰
        self.is_active = True        # í™œì„± ìƒíƒœ
        self.created_by = None       # ìƒì„±ì (ê´€ë¦¬ì ID)
        self.created_at = None       # ìƒì„± ì¼ì‹œ

# ì¿ í° ìœ í˜• ì •ì˜
COUPON_TYPES = {
    'subscription_discount': 'êµ¬ë…ë£Œ í• ì¸',
    'commission_discount': 'ìˆ˜ìˆ˜ë£Œ í• ì¸', 
    'free_trial_extension': 'ë¬´ë£Œ ì²´í—˜ ì—°ì¥',
    'premium_upgrade': 'í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ',
    'lifetime_discount': 'ë¼ì´í”„íƒ€ì„ í• ì¸'
}

DISCOUNT_TYPES = {
    'percentage': 'í¼ì„¼íŠ¸ í• ì¸',
    'fixed_amount': 'ê³ ì • ê¸ˆì•¡ í• ì¸',
    'free_period': 'ë¬´ë£Œ ê¸°ê°„ ì œê³µ'
}

class CouponService:
    """ì¿ í° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤"""
    
    @staticmethod
    def create_coupon(admin_id, coupon_data):
        """ê´€ë¦¬ì ì¿ í° ìƒì„±"""
        import random
        import string
        from datetime import datetime
        
        coupon = Coupon()
        coupon.code = CouponService.generate_coupon_code()
        coupon.name = coupon_data['name']
        coupon.description = coupon_data['description']
        coupon.coupon_type = coupon_data['coupon_type']
        coupon.discount_type = coupon_data['discount_type']
        coupon.discount_value = coupon_data['discount_value']
        coupon.min_purchase_amount = coupon_data.get('min_purchase_amount', 0)
        coupon.max_discount_amount = coupon_data.get('max_discount_amount')
        coupon.usage_limit = coupon_data.get('usage_limit')
        coupon.start_date = coupon_data['start_date']
        coupon.end_date = coupon_data['end_date']
        coupon.target_users = coupon_data.get('target_users', [])
        coupon.target_membership = coupon_data.get('target_membership', [])
        coupon.created_by = admin_id
        coupon.created_at = datetime.now()
        
        return coupon.save()
    
    @staticmethod
    def generate_coupon_code():
        """ì¿ í° ì½”ë“œ ìƒì„± (12ìë¦¬)"""
        return ''.join(random.choices(
            string.ascii_uppercase + string.digits, k=12
        ))
    
    @staticmethod
    def validate_coupon(code, user_id, purchase_amount=0):
        """ì¿ í° ìœ íš¨ì„± ê²€ì¦"""
        from datetime import datetime
        
        coupon = Coupon.get_by_code(code)
        if not coupon:
            return {'valid': False, 'reason': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # í™œì„± ìƒíƒœ í™•ì¸
        if not coupon.is_active:
            return {'valid': False, 'reason': 'ë¹„í™œì„±í™”ëœ ì¿ í°ì…ë‹ˆë‹¤.'}
        
        # ê¸°ê°„ í™•ì¸
        now = datetime.now()
        if now < coupon.start_date or now > coupon.end_date:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ì‚¬ìš© íšŸìˆ˜ í™•ì¸
        if coupon.usage_limit and coupon.used_count >= coupon.usage_limit:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.'}
        
        # ëŒ€ìƒ ì‚¬ìš©ì í™•ì¸
        if coupon.target_users and user_id not in coupon.target_users:
            return {'valid': False, 'reason': 'ì¿ í° ì‚¬ìš© ëŒ€ìƒì´ ì•„ë‹™ë‹ˆë‹¤.'}
        
        # ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ í™•ì¸
        if purchase_amount < coupon.min_purchase_amount:
            return {'valid': False, 'reason': f'ìµœì†Œ êµ¬ë§¤ ê¸ˆì•¡ {coupon.min_purchase_amount:,}ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'}
        
        # íšŒì› ë“±ê¸‰ í™•ì¸
        user = User.get_by_id(user_id)
        if coupon.target_membership and user.membership_type not in coupon.target_membership:
            return {'valid': False, 'reason': 'í•´ë‹¹ íšŒì› ë“±ê¸‰ì€ ì¿ í°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {'valid': True, 'coupon': coupon}
    
    @staticmethod
    def apply_coupon(coupon, user_id, purchase_amount):
        """ì¿ í° ì ìš©"""
        discount_amount = 0
        
        if coupon.discount_type == 'percentage':
            discount_amount = purchase_amount * (coupon.discount_value / 100)
            if coupon.max_discount_amount:
                discount_amount = min(discount_amount, coupon.max_discount_amount)
                
        elif coupon.discount_type == 'fixed_amount':
            discount_amount = coupon.discount_value
            
        elif coupon.discount_type == 'free_period':
            # ë¬´ë£Œ ê¸°ê°„ ì œê³µ ë¡œì§
            user = User.get_by_id(user_id)
            user.extend_free_period(coupon.discount_value)
            discount_amount = purchase_amount  # ì „ì•¡ í• ì¸
        
        # ì¿ í° ì‚¬ìš© ê¸°ë¡
        coupon.used_count += 1
        coupon.save()
        
        # ì‚¬ìš© ì´ë ¥ ì €ì¥
        CouponUsage.create({
            'coupon_id': coupon.coupon_id,
            'user_id': user_id,
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount,
            'used_at': datetime.now()
        })
        
        return {
            'original_amount': purchase_amount,
            'discount_amount': discount_amount,
            'final_amount': purchase_amount - discount_amount
        }
```

### ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
```javascript
// AdminCouponManager.jsx
import React, { useState, useEffect } from 'react'
import {
  Box, Card, CardContent, Typography, Button, Dialog,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Chip, Grid, Alert, IconButton
} from '@mui/material'
import {
  Add, Edit, Delete, Visibility, GetApp
} from '@mui/icons-material'

function AdminCouponManager() {
  const [coupons, setCoupons] = useState([])
  const [createDialog, setCreateDialog] = useState(false)
  const [newCoupon, setNewCoupon] = useState({
    name: '',
    description: '',
    coupon_type: 'subscription_discount',
    discount_type: 'percentage',
    discount_value: '',
    min_purchase_amount: 0,
    max_discount_amount: '',
    usage_limit: '',
    start_date: '',
    end_date: '',
    target_membership: []
  })

  const handleCreateCoupon = async () => {
    try {
      const response = await fetch('/api/admin/coupons', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(newCoupon)
      })
      
      if (response.ok) {
        const createdCoupon = await response.json()
        setCoupons([...coupons, createdCoupon])
        setCreateDialog(false)
        setNewCoupon({})
      }
    } catch (error) {
      console.error('ì¿ í° ìƒì„± ì‹¤íŒ¨:', error)
    }
  }

  const getCouponStatusColor = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'error'
    if (now < startDate) return 'warning'
    if (now > endDate) return 'default'
    return 'success'
  }

  const getCouponStatusText = (coupon) => {
    const now = new Date()
    const startDate = new Date(coupon.start_date)
    const endDate = new Date(coupon.end_date)
    
    if (!coupon.is_active) return 'ë¹„í™œì„±'
    if (now < startDate) return 'ëŒ€ê¸°ì¤‘'
    if (now > endDate) return 'ë§Œë£Œë¨'
    return 'í™œì„±'
  }

  return (
    <Box>
      <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
        <Typography variant="h5">ğŸ« ì¿ í° ê´€ë¦¬</Typography>
        <Button
          variant="contained"
          startIcon={<Add />}
          onClick={() => setCreateDialog(true)}
        >
          ì¿ í° ìƒì„±
        </Button>
      </Box>

      {/* ì¿ í° í†µê³„ */}
      <Grid container spacing={3} mb={3}>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="primary">
                {coupons.filter(c => c.is_active).length}
              </Typography>
              <Typography variant="body2">í™œì„± ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="success.main">
                {coupons.reduce((sum, c) => sum + c.used_count, 0)}
              </Typography>
              <Typography variant="body2">ì´ ì‚¬ìš© íšŸìˆ˜</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="warning.main">
                {coupons.filter(c => new Date() < new Date(c.start_date)).length}
              </Typography>
              <Typography variant="body2">ì˜ˆì•½ëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={3}>
          <Card>
            <CardContent>
              <Typography variant="h6" color="error.main">
                {coupons.filter(c => new Date() > new Date(c.end_date)).length}
              </Typography>
              <Typography variant="body2">ë§Œë£Œëœ ì¿ í°</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* ì¿ í° ëª©ë¡ */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>ì¿ í°ëª…</TableCell>
                  <TableCell>ì½”ë“œ</TableCell>
                  <TableCell>ìœ í˜•</TableCell>
                  <TableCell>í• ì¸ê°’</TableCell>
                  <TableCell>ì‚¬ìš©íšŸìˆ˜</TableCell>
                  <TableCell>ê¸°ê°„</TableCell>
                  <TableCell>ìƒíƒœ</TableCell>
                  <TableCell>ê´€ë¦¬</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {coupons.map((coupon) => (
                  <TableRow key={coupon.coupon_id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {coupon.name}
                      </Typography>
                      <Typography variant="caption" color="textSecondary">
                        {coupon.description}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontFamily="monospace">
                        {coupon.code}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {coupon.coupon_type}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {coupon.discount_type === 'percentage' 
                        ? `${coupon.discount_value}%`
                        : `${coupon.discount_value:,}ì›`}
                    </TableCell>
                    <TableCell>
                      {coupon.used_count} / {coupon.usage_limit || 'ë¬´ì œí•œ'}
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">
                        {new Date(coupon.start_date).toLocaleDateString()} ~<br/>
                        {new Date(coupon.end_date).toLocaleDateString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip 
                        label={getCouponStatusText(coupon)}
                        color={getCouponStatusColor(coupon)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <IconButton size="small">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" color="error">
                        <Delete />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* ì¿ í° ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸ */}
      <Dialog 
        open={createDialog} 
        onClose={() => setCreateDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {/* ì¿ í° ìƒì„± í¼ êµ¬í˜„ */}
      </Dialog>
    </Box>
  )
}

export default AdminCouponManager
```

## ğŸ”„ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2A-Extended: íšŒì› ì‹œìŠ¤í…œ ê³ ë„í™” (D+1 ~ D+21)

#### Week 1: íšŒì› ë“±ê¸‰ ì‹œìŠ¤í…œ ìˆ˜ì •
```powershell
# 1. íšŒì› ëª¨ë¸ ì—…ë°ì´íŠ¸
# User ëª¨ë¸ì— ìƒˆë¡œìš´ í•„ë“œ ì¶”ê°€
- free_trial_end_date    # ë¬´ë£Œ ì²´í—˜ ì¢…ë£Œì¼
- daily_trade_count      # ì¼ì¼ ê±°ë˜ íšŸìˆ˜
- total_extension_days   # ì´ ì—°ì¥ ì¼ìˆ˜
- referral_code          # ê°œì¸ ì´ˆëŒ€ ì½”ë“œ

# 2. ê±°ë˜ ì œí•œ ë¡œì§ êµ¬í˜„
# TradeControllerì—ì„œ íšŒì› ë“±ê¸‰ë³„ ì œí•œ ì²´í¬
```

#### Week 2: ì¹œêµ¬ ì´ˆëŒ€ ì‹œìŠ¤í…œ
```powershell
# 1. ì´ˆëŒ€ ì½”ë“œ ìƒì„± ê¸°ëŠ¥
# ReferralCode ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„

# 2. ì´ˆëŒ€ ë§í¬ ì²˜ë¦¬
# íšŒì›ê°€ì… ì‹œ ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ë¡œì§

# 3. ë³´ìƒ ì§€ê¸‰ ì‹œìŠ¤í…œ
# ìë™ ì—°ì¥ ë° í•œë„ ê´€ë¦¬
```

#### Week 3: ì¿ í° ì‹œìŠ¤í…œ
```powershell
# 1. ì¿ í° ëª¨ë¸ ë° ì„œë¹„ìŠ¤ êµ¬í˜„
# Coupon, CouponUsage ëª¨ë¸ ìƒì„±

# 2. ê´€ë¦¬ì ì¿ í° ê´€ë¦¬ í˜ì´ì§€
# AdminCouponManager ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

# 3. ì¿ í° ì ìš© ë¡œì§
# ê²°ì œ ì‹œìŠ¤í…œê³¼ ì—°ë™
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### ìƒˆë¡œìš´ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ì´ˆëŒ€ ì½”ë“œ í…Œì´ë¸”
CREATE TABLE referral_codes (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    code VARCHAR(8) UNIQUE NOT NULL,
    invite_url VARCHAR(255) NOT NULL,
    max_uses INT DEFAULT 50,
    current_uses INT DEFAULT 0,
    expires_at DATETIME NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì´ˆëŒ€ ë³´ìƒ í…Œì´ë¸”
CREATE TABLE referral_rewards (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    inviter_id BIGINT NOT NULL,
    invitee_id BIGINT NOT NULL,
    referral_code VARCHAR(8) NOT NULL,
    reward_days INT DEFAULT 7,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    applied_at TIMESTAMP,
    is_claimed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (inviter_id) REFERENCES users(id),
    FOREIGN KEY (invitee_id) REFERENCES users(id)
);

-- ì¿ í° í…Œì´ë¸”
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(12) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    coupon_type ENUM('subscription_discount', 'commission_discount', 'free_trial_extension', 'premium_upgrade', 'lifetime_discount') NOT NULL,
    discount_type ENUM('percentage', 'fixed_amount', 'free_period') NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_purchase_amount DECIMAL(10,2) DEFAULT 0,
    max_discount_amount DECIMAL(10,2),
    usage_limit INT,
    used_count INT DEFAULT 0,
    start_date DATETIME NOT NULL,
    end_date DATETIME NOT NULL,
    target_membership JSON,
    target_users JSON,
    is_active BOOLEAN DEFAULT TRUE,
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- ì¿ í° ì‚¬ìš© ì´ë ¥ í…Œì´ë¸”
CREATE TABLE coupon_usage (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    original_amount DECIMAL(10,2) NOT NULL,
    discount_amount DECIMAL(10,2) NOT NULL,
    final_amount DECIMAL(10,2) NOT NULL,
    used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ì‚¬ìš©ì í…Œì´ë¸” ìˆ˜ì • (ìƒˆ ì»¬ëŸ¼ ì¶”ê°€)
ALTER TABLE users ADD COLUMN free_trial_end_date DATETIME;
ALTER TABLE users ADD COLUMN daily_trade_count INT DEFAULT 0;
ALTER TABLE users ADD COLUMN daily_trade_reset_date DATE;
ALTER TABLE users ADD COLUMN total_extension_days INT DEFAULT 0;
ALTER TABLE users ADD COLUMN personal_referral_code VARCHAR(8) UNIQUE;
```

## ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„

### ê±°ë˜ ì œí•œ ê²€ì¦ ì„œë¹„ìŠ¤
```python
# services/TradingLimitService.py
class TradingLimitService:
    """ê±°ë˜ ì œí•œ ê´€ë¦¬ ì„œë¹„ìŠ¤"""
    
    @staticmethod
    def can_make_trade(user_id, trade_type='demo'):
        """ê±°ë˜ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸"""
        user = User.get_by_id(user_id)
        
        # ë¹„íšŒì›ì€ ëª¨ë“  ê±°ë˜ ì°¨ë‹¨
        if not user or not user.is_authenticated:
            return {
                'allowed': False,
                'reason': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                'redirect_to': '/login'
            }
        
        # ë¼ì´í”„íƒ€ì„/í”„ë¦¬ë¯¸ì—„ íšŒì›ì€ ë¬´ì œí•œ
        if user.membership_type in ['lifetime', 'premium']:
            return {'allowed': True}
        
        # ë¬´ë£Œ íšŒì› ì œí•œ ë¡œì§
        if user.membership_type == 'free':
            # ì‹ ê·œ ê°€ì… 7ì¼ ë¬´ë£Œ ê¸°ê°„ í™•ì¸
            if user.is_in_free_trial():
                return {'allowed': True}
            
            # ì¼ì¼ ê±°ë˜ ì œí•œ í™•ì¸ (ë§¤ìˆ˜ 1íšŒ, ë§¤ë„ 1íšŒ)
            today_trades = user.get_today_trade_count()
            if today_trades >= 2:
                return {
                    'allowed': False,
                    'reason': 'ì¼ì¼ ê±°ë˜ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (2íšŒ/ì¼)',
                    'upgrade_suggested': True
                }
            
            # ì‹¤ì „ ê±°ë˜ëŠ” ì°¨ë‹¨
            if trade_type == 'real':
                return {
                    'allowed': False,
                    'reason': 'ì‹¤ì „ ê±°ë˜ëŠ” ìœ ë£Œ íšŒì›ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                    'upgrade_required': True
                }
        
        return {'allowed': True}
    
    @staticmethod
    def record_trade(user_id, trade_type):
        """ê±°ë˜ ê¸°ë¡"""
        user = User.get_by_id(user_id)
        
        if user.membership_type == 'free':
            # ì¼ì¼ ê±°ë˜ íšŸìˆ˜ ì¦ê°€
            from datetime import date
            today = date.today()
            
            if user.daily_trade_reset_date != today:
                user.daily_trade_count = 0
                user.daily_trade_reset_date = today
            
            user.daily_trade_count += 1
            user.save()
```

## ğŸ“± UI/UX ê°œì„ ì‚¬í•­

### íšŒì›ê°€ì… í”Œë¡œìš° 