# Christmas 프로젝트 구조도

## 개요
이 문서는 Christmas 프로젝트의 전체 구조와 각 모듈 간의 관계를 설명합니다. 이 구조도는 개발자가 프로젝트를 이해하고 새로운 기능을 추가하는 데 도움이 됩니다.

## 디렉토리 구조

```
christmas/
├── app/                      # 애플리케이션 코드
│   ├── api/                  # API 모듈
│   │   ├── main.py           # FastAPI 메인 애플리케이션
│   │   └── models.py         # API 데이터 모델(Pydantic)
│   ├── auth/                 # 인증 모듈
│   │   ├── jwt_handler.py    # JWT 토큰 처리
│   │   └── user_model.py     # 사용자 모델
│   ├── backtest/             # 백테스팅 모듈
│   │   ├── simulator.py      # 백테스트 시뮬레이터
│   │   └── analyzer.py       # 결과 분석기
│   ├── execution/            # 주문 실행 모듈
│   │   ├── order_model.py    # 주문 모델
│   │   ├── order_service.py  # 주문 서비스
│   │   └── order_executor.py # 주문 실행기
│   ├── ingestion/            # 데이터 수집 모듈
│   │   ├── market_api.py     # 시장 데이터 API
│   │   └── websocket.py      # 실시간 데이터 수집
│   ├── monitoring/           # 모니터링 모듈
│   │   ├── metrics.py        # 지표 수집
│   │   └── alerts.py         # 알림 시스템
│   ├── notification/         # 알림 모듈
│   │   ├── email.py          # 이메일 알림
│   │   └── messenger.py      # 메시지 알림
│   ├── portfolio/            # 포트폴리오 모듈
│   │   ├── portfolio_model.py# 포트폴리오 모델
│   │   └── position.py       # 포지션 관리
│   ├── rag/                  # RAG 시스템
│   │   ├── indexer.py        # 문서 색인화
│   │   └── query.py          # 질의응답 시스템
│   ├── risk/                 # 위험 관리 모듈
│   │   ├── evaluator.py      # 위험 평가기
│   │   └── stop_loss.py      # 손절매 관리
│   ├── signal/               # 신호 생성 모듈
│   │   ├── indicators.py     # 기술적 지표
│   │   └── pattern.py        # 패턴 인식
│   ├── strategies/           # 전략 모듈
│   │   ├── base.py           # 기본 전략 인터페이스
│   │   ├── scalping.py       # 초단타 전략
│   │   └── swing.py          # 스윙 전략
│   └── web/                  # 웹 인터페이스
│       ├── static/           # 정적 파일
│       │   ├── css/          # CSS 파일
│       │   ├── js/           # JavaScript 파일
│       │   └── images/       # 이미지 파일
│       └── templates/        # HTML 템플릿
├── config/                   # 설정 파일
│   ├── default.yaml          # 기본 설정
│   ├── development.yaml      # 개발 환경 설정
│   └── production.yaml       # 프로덕션 환경 설정
├── docs/                     # 문서
│   ├── api/                  # API 문서
│   ├── architecture/         # 아키텍처 문서
│   └── user/                 # 사용자 매뉴얼
├── scripts/                  # 유틸리티 스크립트
│   ├── setup.py              # 설정 스크립트
│   └── deploy.py             # 배포 스크립트
├── tests/                    # 테스트
│   ├── unit/                 # 단위 테스트
│   ├── integration/          # 통합 테스트
│   └── performance/          # 성능 테스트
├── .dockerignore             # Docker 제외 파일
├── .env                      # 환경 변수
├── .gitignore                # Git 제외 파일
├── docker-compose.yml        # Docker Compose 구성
├── Dockerfile                # Docker 이미지 정의
├── LICENSE                   # 라이선스
├── pyproject.toml            # Python 프로젝트 설정
└── README.md                 # 프로젝트 설명
```

## 모듈 의존성 관계

```
                     +----------------+
                     |      API       |
                     +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|     Auth       |<--|   Execution    |-->|    Signal      |
+----------------+   +----------------+   +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|   Portfolio    |<--|   Strategies   |-->|     Risk       |
+----------------+   +----------------+   +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|   Ingestion    |<--|    Backtest    |-->|   Monitoring   |
+----------------+   +----------------+   +----------------+
                            |
                            v
                     +----------------+
                     |  Notification  |
                     +----------------+
```

## 주요 모듈 설명

### API 모듈 (app/api)
- 외부 시스템과의 인터페이스 제공
- RESTful API 엔드포인트 구현
- 요청 검증 및 응답 포맷팅

### 인증 모듈 (app/auth)
- 사용자 인증 및 권한 관리
- JWT 토큰 기반 인증 처리
- 사용자 정보 관리

### 실행 모듈 (app/execution)
- 주문 생성 및 처리
- 주문 상태 관리
- 주문 실행 및 체결 처리

### 신호 모듈 (app/signal)
- 기술적 지표 계산
- 매매 신호 생성
- 패턴 인식 및 필터링

### 전략 모듈 (app/strategies)
- 매매 전략 구현
- 신호 기반 매매 결정
- 전략 백테스팅 지원

### 포트폴리오 모듈 (app/portfolio)
- 자산 할당 관리
- 포지션 추적
- 성과 분석

### 위험 관리 모듈 (app/risk)
- 위험 평가
- 손절매 관리
- 포지션 사이징

### 데이터 수집 모듈 (app/ingestion)
- 시장 데이터 수집
- 실시간 데이터 처리
- 데이터 정제 및 변환

### 백테스팅 모듈 (app/backtest)
- 전략 백테스팅
- 성능 분석
- 결과 시각화

### 모니터링 모듈 (app/monitoring)
- 시스템 상태 모니터링
- 성능 지표 수집
- 알림 트리거

### 알림 모듈 (app/notification)
- 이메일 알림
- 모바일 푸시 알림
- 텔레그램 메시지

### 웹 인터페이스 (app/web)
- 대시보드 UI
- 설정 페이지
- 데이터 시각화

## 데이터 흐름

1. **시장 데이터 수집**: 데이터 수집 모듈이 외부 API를 통해 시장 데이터를 수집
2. **신호 생성**: 신호 모듈이 시장 데이터를 분석하여 매매 신호 생성
3. **전략 적용**: 전략 모듈이 신호를 받아 매매 결정
4. **주문 실행**: 실행 모듈이 전략의 결정에 따라 주문 생성 및 제출
5. **포지션 관리**: 포트폴리오 모듈이 포지션 추적 및 관리
6. **위험 관리**: 위험 관리 모듈이 포지션 위험 평가 및 조정
7. **알림 전송**: 알림 모듈이 중요 이벤트에 대한 알림 전송
8. **모니터링**: 모니터링 모듈이 시스템 상태 및 성능 추적

## 배포 아키텍처

```
                            +----------------+
                            |   사용자 브라우저   |
                            +----------------+
                                    |
                                    v
+----------------+          +----------------+
|    Vercel      |<-------->|    Netlify     |
+----------------+          +----------------+
        |                           |
        v                           v
+----------------+          +----------------+
|  FastAPI 백엔드  |<-------->|  Supabase DB   |
+----------------+          +----------------+
        |
        v
+----------------+
|   증권사 API     |
+----------------+
```

## 확장 계획

1. **마이크로서비스 아키텍처**: 핵심 모듈을 독립적인 마이크로서비스로 분리
2. **데이터 파이프라인 강화**: Apache Kafka 등을 활용한 실시간 데이터 처리
3. **다중 증권사 지원**: 다양한 증권사 API와의 통합
4. **머신러닝 모델 통합**: 예측 모델과 강화학습 기반 전략 구현
5. **글로벌 시장 확장**: 국내외 다양한 시장 지원 

## 주요 모듈 구조

### app 디렉토리
- **api**: API 인터페이스 및 라우터
- **execution**: 주문 실행 관련 모듈
  - order_model.py: 주문 모델 정의
  - order_service.py: 주문 처리 서비스
  - order_executor.py: 주문 실행기
  - order_service_ext.py: Supabase 연동 확장 서비스
- **ingestion**: 데이터 수집 및 처리 모듈
  - market_api.py: 증권사 API 연동
  - data_processor.py: 데이터 전처리
- **strategy**: 매매 전략 모듈
  - strategy_base.py: 기본 전략 클래스
  - strategy_factory.py: 전략 팩토리
- **db**: 데이터베이스 관련 모듈
  - supabase_client.py: Supabase 클라이언트
  - schema.py: 데이터베이스 스키마 정의
  - order_repository.py: 주문 데이터 리포지토리
- **notification**: 알림 관련 모듈
  - telegram_bot.py: 텔레그램 봇 알림 시스템
- **utils**: 유틸리티 모듈
  - config.py: 설정 관리
  - logger.py: 로깅 설정
  - validation.py: 데이터 검증

### 테스트 모듈
- **tests**: 테스트 코드
  - test_api.py: API 테스트
  - test_order.py: 주문 모듈 테스트
  - test_execution.py: 실행 모듈 테스트
  - test_strategy.py: 전략 모듈 테스트
  - test_supabase.py: Supabase 연동 테스트

### 문서 모듈
- **docs**: 문서 디렉토리
  - api/: API 문서
  - architecture/: 아키텍처 문서
  - user/: 사용자 매뉴얼

## 시스템 아키텍처

```
Christmas 프로젝트
│
├── Frontend
│   ├── 웹 인터페이스
│   ├── 대시보드
│   └── 설정 화면
│
├── Backend
│   ├── API 서버
│   ├── 주문 처리 시스템
│   ├── 데이터 수집 시스템
│   └── 전략 실행 엔진
│
├── 데이터베이스
│   ├── 사용자 정보
│   ├── 주문 내역
│   ├── 포지션 정보
│   ├── 전략 설정
│   └── 성능 지표
│
├── 외부 시스템 연동
│   ├── 증권사 API
│   ├── 시장 데이터 제공자
│   ├── Supabase 클라우드 데이터베이스
│   └── 텔레그램 봇 알림 시스템
│
└── 모니터링 및 알림
    ├── 실시간 모니터링
    ├── 성능 분석
    ├── 텔레그램 알림
    └── 이메일 보고서
```

## 데이터 흐름도

```
시장 데이터 → 데이터 수집 시스템 → 데이터 처리 → 전략 실행 엔진 → 매매 신호 생성
                                                                  ↓
사용자 설정 → API 서버 → 주문 생성 → 주문 처리 시스템 → 증권사 API → 주문 실행
                           ↑              ↓              ↓
                           └─────────── 결과 처리 ← 주문 상태 업데이트
                                          ↓
                                     Supabase DB 저장
                                          ↓
                                     텔레그램 알림
```

## 모듈 의존성

```
                     +----------------+
                     |      API       |
                     +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|     Auth       |<--|   Execution    |-->|    Signal      |
+----------------+   +----------------+   +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|   Portfolio    |<--|   Strategies   |-->|     Risk       |
+----------------+   +----------------+   +----------------+
                            |
                            v
+----------------+   +----------------+   +----------------+
|   Ingestion    |<--|    Backtest    |-->|   Monitoring   |
+----------------+   +----------------+   +----------------+
                            |
                            v
                     +----------------+
                     |  Notification  |
                     +----------------+
``` 