# Nginx í”„ë¡ì‹œ ì„¤ì • ìˆ˜ì • ê³„íš

## ğŸ” ë¬¸ì œ ë¶„ì„

### í˜„ì¬ ìƒí™©
- **ë°±ì—”ë“œ ì„œë²„**: ì •ìƒ ì‘ë™ (Docker ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)
- **Nginx í”„ë¡ì‹œ**: ê¸°ë³¸ ì„¤ì •ë§Œ ìˆìŒ, API í”„ë¡ì‹œ ì„¤ì • ëˆ„ë½
- **API ì ‘ê·¼**: 502 Bad Gateway ì˜¤ë¥˜ ë°œìƒ

### ë¬¸ì œ ì›ì¸
1. **Nginx ì„¤ì • íŒŒì¼**: ì„œë²„ì˜ `/etc/nginx/conf.d/default.conf`ì— API í”„ë¡ì‹œ ì„¤ì •ì´ ì—†ìŒ
2. **Docker ë³¼ë¥¨ ë§ˆìš´íŠ¸**: ë¡œì»¬ ì„¤ì • íŒŒì¼ì´ ì„œë²„ì— ì œëŒ€ë¡œ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
3. **ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘**: ì„¤ì • ë³€ê²½ í›„ Nginx ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ í•„ìš”

## ğŸ¯ í•´ê²° ê³„íš

### Phase 1: í˜„ì¬ ìƒíƒœ í™•ì¸ (5ë¶„)
```bash
# 1. ë¡œì»¬ ì„¤ì • íŒŒì¼ í™•ì¸
cat config/nginx/conf.d/default.conf

# 2. ì„œë²„ ì„¤ì • íŒŒì¼ í™•ì¸
ssh root@31.220.83.213 "docker exec christmas-nginx cat /etc/nginx/conf.d/default.conf"

# 3. Docker ë³¼ë¥¨ ë§ˆìš´íŠ¸ í™•ì¸
ssh root@31.220.83.213 "docker inspect christmas-nginx | grep -A 10 Mounts"
```

### Phase 2: ì„¤ì • íŒŒì¼ ë™ê¸°í™” (10ë¶„)
```bash
# 1. ì„œë²„ì— ìµœì‹  ì½”ë“œ ë™ê¸°í™”
ssh root@31.220.83.213 "cd /root/christmas-trading ; git pull"

# 2. Nginx ì»¨í…Œì´ë„ˆ ì¬ë¹Œë“œ
ssh root@31.220.83.213 "cd /root/christmas-trading ; docker-compose build christmas-nginx"

# 3. Nginx ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
ssh root@31.220.83.213 "cd /root/christmas-trading ; docker-compose up -d christmas-nginx"
```

### Phase 3: ì„¤ì • ê²€ì¦ (5ë¶„)
```bash
# 1. Nginx ì„¤ì • í…ŒìŠ¤íŠ¸
ssh root@31.220.83.213 "docker exec christmas-nginx nginx -t"

# 2. API í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸
ssh root@31.220.83.213 "curl -s http://31.220.83.213/api/health"

# 3. ì‚¬ìš©ì API í…ŒìŠ¤íŠ¸
ssh root@31.220.83.213 "curl -s http://31.220.83.213/api/users/profile/test123"
```

## ğŸ“‹ ì˜¬ë°”ë¥¸ Nginx ì„¤ì •

### í•„ìš”í•œ í”„ë¡ì‹œ ì„¤ì •
```nginx
# API ê²½ë¡œ í”„ë¡ì‹œ
location /api/ {
    proxy_pass http://christmas-backend:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # CORS í—¤ë” ì¶”ê°€
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type, Authorization";
}

# í—¬ìŠ¤ì²´í¬ ê²½ë¡œ
location /health {
    proxy_pass http://christmas-backend:8000/health;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### Docker Compose ì„¤ì • í™•ì¸
- Nginx ì»¨í…Œì´ë„ˆê°€ ì˜¬ë°”ë¥¸ ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
- ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆì™€ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ”ì§€ í™•ì¸
- í¬íŠ¸ ë§¤í•‘ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

### í™˜ê²½ë³„ ì„¤ì •
- **ê°œë°œ í™˜ê²½**: HTTPë§Œ ì‚¬ìš©
- **í”„ë¡œë•ì…˜ í™˜ê²½**: HTTPS ê°•ì œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- **Docker ë„¤íŠ¸ì›Œí¬**: ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ í†µì‹ 

## ğŸ“ˆ ì˜ˆìƒ ê²°ê³¼

### ì„±ê³µ ì‹œ í™•ì¸ ì‚¬í•­
- [ ] `curl http://31.220.83.213/api/health` â†’ 200 OK
- [ ] `curl http://31.220.83.213/api/users/profile/test` â†’ JSON ì‘ë‹µ
- [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ "ë°±ì—”ë“œ ì—°ê²°ë¨" í‘œì‹œ
- [ ] Nginx ì»¨í…Œì´ë„ˆ healthy ìƒíƒœ

### ì‹¤íŒ¨ ì‹œ ëŒ€ì•ˆ
1. **ìˆ˜ë™ ì„¤ì • ë³µì‚¬**: ë¡œì»¬ íŒŒì¼ì„ ì„œë²„ì— ì§ì ‘ ë³µì‚¬
2. **ì»¨í…Œì´ë„ˆ ì¬ìƒì„±**: ì™„ì „íˆ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆë¡œ êµì²´
3. **ë„¤íŠ¸ì›Œí¬ ì¬ì„¤ì •**: Docker ë„¤íŠ¸ì›Œí¬ ì¬ìƒì„±

---

**ì‘ì„±ì¼**: 2025-05-25 19:05  
**ìš°ì„ ìˆœìœ„**: ğŸ”´ ê¸´ê¸‰  
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 20ë¶„  
**ë‹´ë‹¹ì**: ì‹œìŠ¤í…œ ê´€ë¦¬ì 