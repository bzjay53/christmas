# Christmas 프로젝트 - 클라우드 기반 무료 서비스 아키텍처 설계서

## 📋 개요

Christmas Trading 프로젝트를 로컬 PC 의존성 없이 24시간 운영 가능한 클라우드 기반 시스템으로 전환하는 설계서입니다. 무료 서비스들을 최대한 활용하여 확장성과 안정성을 확보합니다.

## 🏗️ 클라우드 아키텍처 설계

### 📊 현재 상황 분석
- **백엔드**: MongoDB + Express.js (로컬 의존)
- **프론트엔드**: React + Vite (Netlify 배포 준비)
- **데이터베이스**: 로컬 MongoDB (클라우드 전환 필요)
- **인증**: JWT 기반 (Supabase Auth로 전환 검토)

### 🎯 목표 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Backend       │    │   Database      │
│   (Netlify)     │────│  (Supabase      │────│   (Supabase     │
│   - React       │    │   Functions)    │    │   PostgreSQL)   │
│   - Vite        │    │   - API Routes  │    │   - Auth        │
│   - PWA Ready   │    │   - Auth Logic  │    │   - Real-time   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
         ┌─────────────────┐    │    ┌─────────────────┐
         │   Monitoring    │    │    │   File Storage  │
         │   (Sentry)      │────┼────│   (Supabase     │
         │   - Error Track │    │    │   Storage)      │
         │   - Performance │    │    │   - Images      │
         └─────────────────┘    │    └─────────────────┘
                                │
         ┌─────────────────┐    │    ┌─────────────────┐
         │   Automation    │    │    │   Analytics     │
         │   (GitHub       │────┼────│   (Netlify      │
         │   Actions)      │    │    │   Analytics)    │
         │   - CI/CD       │    │    │   - User Track  │
         └─────────────────┘    │    └─────────────────┘
                                │
                    ┌─────────────────┐
                    │   External APIs │
                    │   - KIS API     │
                    │   - Telegram    │
                    │   - Weather     │
                    └─────────────────┘
```

## 🆓 무료 서비스 활용 계획

### 1. **프론트엔드 호스팅: Netlify**
```yaml
서비스: Netlify (무료 플랜)
제한사항:
  - 대역폭: 100GB/월
  - 빌드 시간: 300분/월
  - 사이트 수: 무제한
  - 사용자 정의 도메인: 지원
장점:
  - 자동 CI/CD
  - Preview 배포
  - 글로벌 CDN
  - 무료 SSL 인증서
```

### 2. **백엔드 & 데이터베이스: Supabase**
```yaml
서비스: Supabase (무료 플랜)
제한사항:
  - 데이터베이스 크기: 500MB
  - API 요청: 50만회/월
  - 스토리지: 1GB
  - 동시 연결: 500개
장점:
  - PostgreSQL 데이터베이스
  - 실시간 구독
  - 자동 API 생성
  - 인증 시스템 내장
  - Edge Functions
```

### 3. **CI/CD: GitHub Actions**
```yaml
서비스: GitHub Actions (무료 플랜)
제한사항:
  - 빌드 시간: 2000분/월 (퍼블릭 레포)
  - 스토리지: 500MB
장점:
  - 자동 배포
  - 테스트 자동화
  - 다중 환경 지원
```

### 4. **모니터링: Sentry**
```yaml
서비스: Sentry (무료 플랜)
제한사항:
  - 에러 이벤트: 5000개/월
  - 성능 모니터링: 제한적
장점:
  - 실시간 에러 추적
  - 성능 모니터링
  - 알림 시스템
```

### 5. **텔레그램 봇: Telegram Bot API**
```yaml
서비스: Telegram Bot API (완전 무료)
제한사항: 없음
장점:
  - 실시간 알림
  - 무제한 메시지
  - 웹훅 지원
```

## 📝 WBS (Work Breakdown Structure)

### Phase 1: 인프라 설정 (1-2일)
```
1. Supabase 프로젝트 설정
   1.1 계정 생성 및 프로젝트 초기화
   1.2 데이터베이스 스키마 설계
   1.3 Row Level Security (RLS) 설정
   1.4 API 키 및 환경변수 설정

2. Netlify 배포 환경 구성
   2.1 GitHub 연동 설정
   2.2 빌드 설정 최적화
   2.3 환경변수 설정
   2.4 도메인 설정
```

### Phase 2: 데이터 마이그레이션 (2-3일)
```
3. MongoDB에서 Supabase로 데이터 모델 전환
   3.1 User 테이블 마이그레이션
   3.2 ReferralCode 테이블 마이그레이션
   3.3 ReferralReward 테이블 마이그레이션
   3.4 Coupon 및 CouponUsage 테이블 마이그레이션

4. 인증 시스템 전환
   4.1 Supabase Auth 설정
   4.2 JWT에서 Supabase Auth로 전환
   4.3 프론트엔드 인증 로직 업데이트
```

### Phase 3: API 및 비즈니스 로직 전환 (3-4일)
```
5. Supabase Functions 구현
   5.1 회원가입/로그인 로직
   5.2 초대 시스템 로직
   5.3 쿠폰 시스템 로직
   5.4 거래 권한 검증 로직

6. 실시간 기능 구현
   6.1 실시간 포트폴리오 업데이트
   6.2 실시간 알림 시스템
   6.3 실시간 거래 모니터링
```

### Phase 4: 통합 및 테스트 (2-3일)
```
7. 프론트엔드-백엔드 통합
   7.1 API 엔드포인트 연결
   7.2 상태 관리 업데이트
   7.3 에러 핸들링 구현

8. 테스트 및 검증
   8.1 기능 테스트
   8.2 성능 테스트
   8.3 보안 테스트
   8.4 사용자 시나리오 테스트
```

### Phase 5: 배포 및 모니터링 (1-2일)
```
9. 프로덕션 배포
   9.1 환경별 설정 분리
   9.2 도메인 연결
   9.3 SSL 인증서 설정

10. 모니터링 및 분석 설정
    10.1 Sentry 에러 추적 설정
    10.2 Netlify Analytics 설정
    10.3 Supabase 모니터링 설정
```

## 🔧 구현 우선순위

### 🚀 즉시 시작 (오늘)
1. **Supabase 프로젝트 설정**
2. **기본 테이블 스키마 생성**
3. **Netlify 환경변수 설정**

### 📅 1-2일 내
1. **인증 시스템 전환**
2. **기본 API Functions 구현**
3. **프론트엔드 연동**

### 📅 3-5일 내
1. **실시간 기능 구현**
2. **텔레그램 봇 연동**
3. **모니터링 시스템 구축**

## 💰 비용 분석

### 무료 티어 제한사항
```yaml
Supabase 무료 플랜:
  - 월 50만 API 요청 (충분)
  - 500MB 데이터베이스 (초기에 충분)
  - 1GB 스토리지 (충분)

Netlify 무료 플랜:
  - 월 100GB 대역폭 (충분)
  - 월 300분 빌드 시간 (충분)

총 비용: $0/월 (완전 무료)
```

### 확장 시 비용 계획
```yaml
Supabase Pro ($25/월):
  - 8GB 데이터베이스
  - 100GB 스토리지
  - 무제한 API 요청

Netlify Pro ($19/월):
  - 무제한 대역폭
  - 무제한 빌드 시간

확장 시 총 비용: $44/월
```

## 🔒 보안 고려사항

### 1. **환경변수 관리**
- Netlify 환경변수로 API 키 관리
- Supabase RLS로 데이터 접근 제어
- GitHub Secrets으로 CI/CD 보안

### 2. **API 보안**
- Supabase Auth 토큰 검증
- Rate Limiting 적용
- CORS 정책 설정

### 3. **데이터 보안**
- PostgreSQL RLS 정책
- 암호화된 연결
- 정기적인 백업

## 📊 모니터링 계획

### 1. **에러 모니터링**
- Sentry로 실시간 에러 추적
- 텔레그램으로 중요 에러 알림
- 주간 에러 리포트 자동 생성

### 2. **성능 모니터링**
- Netlify Analytics로 사용자 추적
- Supabase 대시보드로 DB 성능 모니터링
- API 응답 시간 추적

### 3. **사용량 모니터링**
- 무료 티어 한도 추적
- 자동 알림 시스템
- 사용량 최적화 가이드

## 🎯 다음 단계

1. **즉시 시작**: Supabase 프로젝트 설정
2. **데이터 모델 설계**: PostgreSQL 스키마 작성
3. **인증 시스템 구현**: Supabase Auth 연동
4. **API Functions 개발**: 비즈니스 로직 구현
5. **프론트엔드 연동**: React 앱 업데이트
6. **테스트 및 배포**: 통합 테스트 후 배포

---

**목표**: 완전한 클라우드 네이티브 아키텍처로 24시간 안정적 운영  
**예산**: $0 (무료 서비스만 활용)  
**완료 예정**: 7-10일 내  
**확장성**: 필요시 유료 플랜으로 쉬운 확장 가능 